# 텍스트 오버레이 QA 규칙 (강제)

> **2026-01-30 PD 지시:** 텍스트 중복 사고 재발 방지
> **적용:** 모든 콘텐츠 렌더링 후 필수 검수

---

## 🚨 P0 - 텍스트 중복 검사 (필수)

### 육안 검사 체크리스트

렌더링 완료 후 **모든 슬라이드**에 대해 아래 검사 수행:

```
□ 제목 텍스트가 한 번만 보이는가?
□ 부제목 텍스트가 한 번만 보이는가?
□ 텍스트 아래에 고스트/그림자처럼 보이는 중복이 없는가?
□ 텍스트가 선명하게 보이는가? (흐릿한 복제본 없음)
```

### 검사 방법

1. **200% 확대 검사**: 이미지를 2배 확대하여 텍스트 영역 검사
2. **흑백 변환 검사**: 이미지를 그레이스케일로 변환하여 중복 텍스트 확인
3. **배경과 비교**: 텍스트 영역만 잘라서 단색 배경에서 확인

---

## 렌더링 스크립트 규칙

### 금지 사항

```
❌ overlay.html 템플릿에서 기본 텍스트 남기기
❌ CSS text-shadow로 "들어올리기" 효과 과다 사용
❌ Puppeteer evaluate() 전에 템플릿 자체 스크립트 실행
❌ 폰트 로딩 완료 전 스크린샷
```

### 필수 사항

```
✅ 템플릿 기본 텍스트를 빈 문자열로 초기화
✅ 텍스트 적용 후 최소 1초 대기
✅ document.fonts.ready 확인 후 스크린샷
✅ 렌더링 결과 즉시 육안 검사
```

---

## 검수 단계별 책임

| 단계 | 담당 | 검사 항목 |
|------|------|----------|
| 렌더링 직후 | 김과장 | 텍스트 중복 즉시 확인 |
| G2 검수 | 김감독 | 200% 확대 검사 |
| 최종 승인 | 김부장 | 전체 슬라이드 일괄 검토 |

---

## 자동화 검증 (권장)

### 1. 이미지 해시 비교
```python
# 텍스트 영역 추출 후 중복 패턴 감지
def check_text_duplication(image_path):
    img = Image.open(image_path)
    text_area = img.crop((0, 820, 1080, 1080))  # 하단 텍스트 영역
    # OCR로 텍스트 추출
    # 같은 텍스트가 2번 이상 나오면 경고
```

### 2. OCR 기반 검증
- pytesseract로 텍스트 영역 OCR
- 추출된 텍스트에서 중복 문자열 감지
- 중복 발견 시 자동 FAIL

---

## 위반 시 조치

1. **즉시 재렌더링** (추가 검수 없이 진행 금지)
2. **CLAUDE.md에 실패 사례 기록**
3. **렌더링 스크립트 원인 분석 후 수정**

---

## 사고 기록

### [2026-01-30] grape 콘텐츠 텍스트 중복

- **발견:** grape_01, grape_03 부제목 이중 출력
- **원인:** overlay.html 템플릿 + lift-light CSS 충돌 추정
- **영향:** 2주간 미발견, QA 전면 실패
- **조치:** 본 문서 작성, 검수 프로세스 강화

