#!/usr/bin/env python3
"""
ë¸”ë¡œê·¸ ìº¡ì…˜ ë°°ì¹˜ ì¬ìƒì„±
BLOG_RULE.md v3.0 ê¸°ì¤€
"""

import json
import re
from pathlib import Path

PROJECT_ROOT = Path(__file__).parent.parent
CONTENTS_DIR = PROJECT_ROOT / "01_contents"
FOOD_DATA_PATH = PROJECT_ROOT / "config" / "food_data.json"

# ì•ˆì „ë„ë³„ í›„í‚¹ ë¬¸êµ¬
HOOKING = {
    "SAFE": '"ì´ê±° ì¤˜ë„ ë˜ë‚˜?" ê²€ìƒ‰í•´ë³¸ ì  ìˆë‹¤ë©´, ë‹¹ì‹ ì€ ì¢‹ì€ ë³´í˜¸ìì˜ˆìš”.',
    "CAUTION": "ì‚¬ë‘í•˜ë‹ˆê¹Œ í•œ ë²ˆ ë” í™•ì¸í•˜ëŠ” ê±°ì˜ˆìš”.",
    "DANGER": "ì•Œê³  ìˆëŠ” ê²ƒê³¼ ëª¨ë¥´ëŠ” ê²ƒ, ê·¸ ì°¨ì´ê°€ ìš°ë¦¬ ì•„ì´ë¥¼ ì§€ì¼œìš”.",
    "FORBIDDEN": "ëª°ëë‹¤ë©´ ê´œì°®ì•„ìš”. ì§€ê¸ˆ ì•Œì•˜ìœ¼ë‹ˆê¹Œìš”."
}

# ì•ˆì „ë„ë³„ ì´ëª¨ì§€
EMOJI = {
    "SAFE": "ğŸŸ¢",
    "CAUTION": "ğŸŸ¡",
    "DANGER": "ğŸŸ ",
    "FORBIDDEN": "â›”"
}

# ì•ˆì „ë„ë³„ ê²°ë¡  ë¬¸êµ¬
CONCLUSION = {
    "SAFE": "ê¸‰ì—¬ ê°€ëŠ¥!",
    "CAUTION": "ì¡°ê±´ë¶€ ê¸‰ì—¬ ê°€ëŠ¥!",
    "DANGER": "ê¸‰ì—¬ ë¹„ê¶Œì¥!",
    "FORBIDDEN": "ì ˆëŒ€ ê¸‰ì—¬ ê¸ˆì§€!"
}

def load_food_data():
    with open(FOOD_DATA_PATH, "r", encoding="utf-8") as f:
        return json.load(f)

def get_folder(num: int) -> Path:
    pattern = f"{num:03d}_*"
    matches = list(CONTENTS_DIR.glob(pattern))
    return matches[0] if matches else None

def generate_safe_caution_caption(food: dict, safety: str) -> str:
    """SAFE/CAUTION ìº¡ì…˜ ìƒì„±"""
    name = food["name"]
    emoji = EMOJI[safety]
    hooking = HOOKING[safety]
    conclusion = CONCLUSION[safety]

    # ì˜ì–‘ì†Œ
    nutrients = food.get("nutrients", [])
    nutrient_lines = []
    for n in nutrients[:5]:
        nutrient_lines.append(f"â€¢ {n['name']} ({n.get('value', '')}{n.get('unit', '')}): {n['benefit']}")

    # ê¸‰ì—¬ëŸ‰
    dosages = food.get("dosages", {})
    dosage_lines = []
    for size in ["ì†Œí˜•ê²¬", "ì¤‘í˜•ê²¬", "ëŒ€í˜•ê²¬", "ì´ˆëŒ€í˜•ê²¬"]:
        if size in dosages:
            d = dosages[size]
            dosage_lines.append(f"â€¢ {size}({d['weight']}): {d['amount']} ({d['desc']})")

    # ì£¼ì˜ì‚¬í•­
    precautions = food.get("precautions", [])
    precaution_lines = []
    for p in precautions[:4]:
        precaution_lines.append(f"â€¢ {p['title']}: {p['desc']}")

    # DO/DON'T
    do_items = food.get("do_items", [])
    dont_items = food.get("dont_items", [])

    # ì¡°ë¦¬ë²•
    cooking_steps = food.get("cooking_steps", [])
    cooking_lines = []
    for i, step in enumerate(cooking_steps[:5], 1):
        cooking_lines.append(f"{i}. {step['title']}: {step['desc']}")

    # CAUTION ì¶”ê°€ ë¬¸êµ¬
    caution_extra = ""
    if safety == "CAUTION":
        caution_extra = "\nâš ï¸ ì£¼ 1~2íšŒë¡œ íšŸìˆ˜ë¥¼ ì œí•œí•´ì£¼ì„¸ìš”."

    caption = f'''"{name}", ê°•ì•„ì§€í•œí…Œ ì¤˜ë„ ë ê¹Œ? ğŸ¤” {hooking}

[ì´ë¯¸ì§€ 1ë²ˆ: í–‡ì‚´ì´ì™€ {name} í‘œì§€]

ì•ˆë…•í•˜ì„¸ìš”, í–‡ì‚´ì´ë„¤ì…ë‹ˆë‹¤! ğŸ•
ì˜¤ëŠ˜ì€ ë§ì€ ë³´í˜¸ìë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì‹œëŠ” '{name}' ê¸‰ì—¬ì— ëŒ€í•´ ì•Œì•„ë³¼ê²Œìš”.
11ì‚´ ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„ í–‡ì‚´ì´ë¥¼ í‚¤ìš°ë©´ì„œ ì–»ì€ ê²½í—˜ê³¼ ìˆ˜ì˜ì‚¬ ì„ ìƒë‹˜ì˜ ì¡°ì–¸ì„ ë°”íƒ•ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

[ì´ë¯¸ì§€ 2ë²ˆ: {name} ìŒì‹ ì‚¬ì§„]

## ğŸ½ï¸ {name}, ê°•ì•„ì§€ì—ê²Œ ì–´ë–¤ ìŒì‹ì¼ê¹Œìš”?

{name}ì€ ë§ì€ ë³´í˜¸ìë¶„ë“¤ì´ ê¸‰ì—¬ ê°€ëŠ¥ ì—¬ë¶€ë¥¼ ê¶ê¸ˆí•´í•˜ëŠ” ìŒì‹ì´ì—ìš”. ì €í¬ í–‡ì‚´ì´ë„ {name} ëƒ„ìƒˆë¥¼ ë§¡ìœ¼ë©´ ê´€ì‹¬ì„ ë³´ì´ë”ë¼ê³ ìš”.

[ì´ë¯¸ì§€ 3ë²ˆ: í–‡ì‚´ì´ì™€ {name} í•¨ê»˜]

## ğŸ“Š {name}ì˜ ì˜ì–‘ ì •ë³´

{name}ì—ëŠ” ê°•ì•„ì§€ì—ê²Œ ë„ì›€ì´ ë˜ëŠ” ì˜ì–‘ì†Œê°€ ë“¤ì–´ìˆì–´ìš”.

{chr(10).join(nutrient_lines)}

ì´ëŸ¬í•œ ì˜ì–‘ì†Œë“¤ì´ ê°•ì•„ì§€ì˜ ê±´ê°• ìœ ì§€ì— ë„ì›€ì„ ì¤„ ìˆ˜ ìˆì–´ìš”.

[ì´ë¯¸ì§€ 4ë²ˆ: {name} ì˜ì–‘ì •ë³´ ì¸í¬ê·¸ë˜í”½]

## {emoji} ê²°ë¡ : {name}, ê°•ì•„ì§€ {conclusion}

{name}ì€ ì£¼ì˜ì‚¬í•­ì„ ì§€í‚¤ë©´ ê¸‰ì—¬ ê°€ëŠ¥í•œ ìŒì‹ì´ì—ìš”.
ì²˜ìŒ ê¸‰ì—¬í•  ë•ŒëŠ” ê·¹ì†ŒëŸ‰ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.

âœ… ì´ë ‡ê²Œ ì£¼ì„¸ìš”
{chr(10).join(["â€¢ " + item for item in do_items[:5]])}

âŒ ì´ë ‡ê²ŒëŠ” ì•ˆ ë¼ìš”
{chr(10).join(["â€¢ " + item for item in dont_items[:5]])}

[ì´ë¯¸ì§€ 5ë²ˆ: {name} ê¸‰ì—¬ê°€ëŠ¥/ë¶ˆê°€ ì¸í¬ê·¸ë˜í”½]

## ğŸ“ ì²´ì¤‘ë³„ í•˜ë£¨ ê¸‰ì—¬ëŸ‰

{chr(10).join(dosage_lines)}{caution_extra}

â€» ì²˜ìŒ ê¸‰ì—¬ ì‹œì—ëŠ” ì†ŒëŸ‰ìœ¼ë¡œ ì‹œì‘í•´ì„œ ë°˜ì‘ì„ ì‚´í´ì£¼ì„¸ìš”.
â€» í•˜ë£¨ ì¹¼ë¡œë¦¬ì˜ 10%ë¥¼ ë„˜ì§€ ì•Šë„ë¡ í•´ì£¼ì„¸ìš”.

[ì´ë¯¸ì§€ 6ë²ˆ: {name} ê¸‰ì—¬ëŸ‰í‘œ ì¸í¬ê·¸ë˜í”½]

## âš ï¸ ì£¼ì˜ì‚¬í•­

{chr(10).join(precaution_lines)}

ìœ„ ì‚¬í•­ë“¤ì„ ê¼­ ì§€ì¼œì£¼ì„¸ìš”. ê°•ì•„ì§€ë§ˆë‹¤ ê°œì²´ ì°¨ì´ê°€ ìˆìœ¼ë¯€ë¡œ ì²˜ìŒ ê¸‰ì—¬ ì‹œì—ëŠ” ë°˜ë“œì‹œ ì†ŒëŸ‰ë¶€í„° ì‹œì‘í•˜ê³  ë°˜ì‘ì„ ê´€ì°°í•´ì£¼ì„¸ìš”.

[ì´ë¯¸ì§€ 7ë²ˆ: {name} ì£¼ì˜ì‚¬í•­ ì¸í¬ê·¸ë˜í”½]

## ğŸ‘¨â€ğŸ³ ê°•ì•„ì§€ìš© {name} ê¸‰ì—¬ ë°©ë²•

{chr(10).join(cooking_lines)}

TIP: {food.get("cooking_tip", "ì‹ ì„ í•œ ê²ƒìœ¼ë¡œ ê°„ë‹¨í•˜ê²Œ ì¤€ë¹„í•´ì£¼ì„¸ìš”")}

[ì´ë¯¸ì§€ 8ë²ˆ: {name} ì¡°ë¦¬ë°©ë²• ì¸í¬ê·¸ë˜í”½]

## â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

Q1. {name}ì„ ì²˜ìŒ ì¤„ ë•Œ ì£¼ì˜í•  ì ì€?
A1. ì•„ì£¼ ì†ŒëŸ‰ë¶€í„° ì‹œì‘í•´ì„œ ì•Œë ˆë¥´ê¸° ë°˜ì‘ì´ ì—†ëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”. 24ì‹œê°„ ì´ìƒ ê´€ì°° í›„ ì´ìƒì´ ì—†ìœ¼ë©´ ì¡°ê¸ˆì”© ëŠ˜ë ¤ë„ ë©ë‹ˆë‹¤.

Q2. {name}ì„ ìì£¼ ì¤˜ë„ ë˜ë‚˜ìš”?
A2. ì£¼ 2~3íšŒ ì •ë„ê°€ ì ë‹¹í•´ìš”. ë‹¤ë¥¸ ê°„ì‹ê³¼ ë¡œí…Œì´ì…˜í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

Q3. ì–´ë¦° ê°•ì•„ì§€ì—ê²Œë„ {name}ì„ ì¤˜ë„ ë˜ë‚˜ìš”?
A3. ìƒí›„ 6ê°œì›” ì´í›„, ì†ŒëŸ‰ë¶€í„° ì‹œì‘í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•´ìš”.

[ì´ë¯¸ì§€ 9ë²ˆ: í–‡ì‚´ì´ ë§ˆë¬´ë¦¬ CTA ì´ë¯¸ì§€]

ì˜¤ëŠ˜ë„ ìš°ë¦¬ ì•„ì´ ê±´ê°• ì±™ê¸°ëŠ” ë³´í˜¸ìë‹˜ë“¤ ì‘ì›í•©ë‹ˆë‹¤! ğŸ’•
ê¶ê¸ˆí•œ ì ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.

ğŸ’¬ ìš°ë¦¬ ì•„ì´ì—ê²Œ ë§ëŠ” ê¸‰ì—¬ëŸ‰ì€ ìˆ˜ì˜ì‚¬ ì„ ìƒë‹˜ê³¼ ìƒë‹´í•˜ì„¸ìš”!
ğŸ’¬ ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ ì €ì¥í•˜ê³  ê³µìœ í•´ì£¼ì„¸ìš”!

í–‡ì‚´ì´ì™€ í•¨ê»˜í•˜ëŠ” 11ë…„, ì•ìœ¼ë¡œë„ ê±´ê°•í•œ ì •ë³´ë¡œ ì°¾ì•„ëµê²Œìš”. ğŸ¾

#ê°•ì•„ì§€{name} #ê°œ{name} #{name}ê¸‰ì—¬ #ê°•ì•„ì§€ê°„ì‹ #ë°˜ë ¤ê²¬ì˜ì–‘ #ê°•ì•„ì§€ë¨¹ì–´ë„ë˜ëŠ”ìŒì‹ #ê°œë¨¹ì–´ë„ë˜ëŠ”ìŒì‹ #ë°˜ë ¤ê²¬ê°„ì‹ #í«í‘¸ë“œ #ê°•ì•„ì§€ê±´ê°• #ë°˜ë ¤ê²¬ê±´ê°• #í«ì˜ì–‘ #í–‡ì‚´ì´ë„¤ #ê°•ì•„ì§€ìŒì‹ #ë°˜ë ¤ê²¬ìŒì‹
'''
    return caption.strip()


def generate_danger_caption(food: dict) -> str:
    """DANGER ìº¡ì…˜ ìƒì„±"""
    name = food["name"]
    emoji = EMOJI["DANGER"]
    hooking = HOOKING["DANGER"]

    # ë…ì„± ì„±ë¶„
    toxicity = food.get("toxicity", [])
    toxicity_lines = []
    for t in toxicity[:3]:
        toxicity_lines.append(f"â€¢ {t.get('name', 'ì„±ë¶„')}: {t.get('effect', 'ìœ„í—˜')}")
    if not toxicity_lines:
        toxicity_lines = ["â€¢ ê³¼ë‹¤ ì„­ì·¨ ì‹œ ì†Œí™” ë¬¸ì œ ìœ ë°œ ê°€ëŠ¥", "â€¢ íŠ¹ì • ì„±ë¶„ì´ ê°•ì•„ì§€ì—ê²Œ ë¶€ë‹´ë  ìˆ˜ ìˆìŒ"]

    # ì¤‘ë… ì¦ìƒ
    symptoms = food.get("symptoms", [])
    symptom_lines = []
    for s in symptoms[:4]:
        symptom_lines.append(f"â€¢ {s}")
    if not symptom_lines:
        symptom_lines = ["â€¢ êµ¬í† ", "â€¢ ì„¤ì‚¬", "â€¢ ë¬´ê¸°ë ¥", "â€¢ ì‹ìš• ì €í•˜"]

    # ëŒ€ì•ˆ ì‹í’ˆ
    alternatives = food.get("alternatives", [])
    alt_lines = []
    for a in alternatives[:3]:
        alt_lines.append(f"â€¢ {a}")
    if not alt_lines:
        alt_lines = ["â€¢ ìˆ˜ì˜ì‚¬ì™€ ìƒë‹´ í›„ ì•ˆì „í•œ ëŒ€ì•ˆ ì„ íƒ"]

    caption = f'''"{name}", ê°•ì•„ì§€í•œí…Œ ì¤˜ë„ ë ê¹Œ? ğŸ¤” {hooking}

[ì´ë¯¸ì§€ 1ë²ˆ: í–‡ì‚´ì´ì™€ {name} í‘œì§€]

ì•ˆë…•í•˜ì„¸ìš”, í–‡ì‚´ì´ë„¤ì…ë‹ˆë‹¤! ğŸ•
ì˜¤ëŠ˜ì€ ë§ì€ ë³´í˜¸ìë¶„ë“¤ì´ ê¶ê¸ˆí•´í•˜ì‹œëŠ” '{name}' ê¸‰ì—¬ì— ëŒ€í•´ ì•Œì•„ë³¼ê²Œìš”.
11ì‚´ ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„ í–‡ì‚´ì´ë¥¼ í‚¤ìš°ë©´ì„œ ì–»ì€ ê²½í—˜ê³¼ ìˆ˜ì˜ì‚¬ ì„ ìƒë‹˜ì˜ ì¡°ì–¸ì„ ë°”íƒ•ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

[ì´ë¯¸ì§€ 2ë²ˆ: {name} ìŒì‹ ì‚¬ì§„]

## âš ï¸ {name}, ì™œ ìœ„í—˜í• ê¹Œìš”?

{name}ì€ ê°•ì•„ì§€ì—ê²Œ ê¶Œì¥í•˜ì§€ ì•ŠëŠ” ìŒì‹ì´ì—ìš”. íŠ¹ì • ì„±ë¶„ì´ ê°•ì•„ì§€ì˜ ê±´ê°•ì— ë¶€ì •ì ì¸ ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆì–´ìš”.

[ì´ë¯¸ì§€ 3ë²ˆ: í–‡ì‚´ì´ì™€ {name} í•¨ê»˜]

## ğŸ”¬ ìœ„í—˜ ì„±ë¶„ ë¶„ì„

{name}ì—ëŠ” ê°•ì•„ì§€ì—ê²Œ í•´ë¡œìš¸ ìˆ˜ ìˆëŠ” ì„±ë¶„ì´ í¬í•¨ë˜ì–´ ìˆì–´ìš”.

{chr(10).join(toxicity_lines)}

ì´ëŸ¬í•œ ì„±ë¶„ë“¤ì´ ê°•ì•„ì§€ì˜ ê±´ê°•ì„ ìœ„í˜‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[ì´ë¯¸ì§€ 4ë²ˆ: {name} ë…ì„±ì„±ë¶„ ì¸í¬ê·¸ë˜í”½]

## {emoji} ê²°ë¡ : {name}, ê°•ì•„ì§€ ê¸‰ì—¬ ë¹„ê¶Œì¥!

{name}ì€ ê°•ì•„ì§€ì—ê²Œ ê¸‰ì—¬ë¥¼ ê¶Œì¥í•˜ì§€ ì•Šì•„ìš”.
ë§Œì•½ ì‹¤ìˆ˜ë¡œ ì„­ì·¨í–ˆë‹¤ë©´ ì¦ìƒì„ ê´€ì°°í•˜ê³  ìˆ˜ì˜ì‚¬ì™€ ìƒë‹´í•˜ì„¸ìš”.

âš ï¸ ì£¼ì˜ì‚¬í•­
â€¢ ì˜ë„ì ìœ¼ë¡œ ê¸‰ì—¬í•˜ì§€ ë§ˆì„¸ìš”
â€¢ ì‹¤ìˆ˜ë¡œ ì„­ì·¨ ì‹œ ì–‘ì„ íŒŒì•…í•˜ì„¸ìš”
â€¢ ì¦ìƒ ë°œí˜„ ì‹œ ì¦‰ì‹œ ë³‘ì› ë°©ë¬¸
â€¢ ìŒì‹ë¬¼ ì ‘ê·¼ì„ ì°¨ë‹¨í•˜ì„¸ìš”

[ì´ë¯¸ì§€ 5ë²ˆ: {name} ê¸‰ì—¬ê¸ˆì§€ ì¸í¬ê·¸ë˜í”½]

## ğŸš¨ ì¤‘ë… ì¦ìƒ

{name}ì„ ì„­ì·¨í–ˆì„ ë•Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” ì¦ìƒ:

{chr(10).join(symptom_lines)}

ì¦ìƒì´ ë‚˜íƒ€ë‚˜ë©´ ì¦‰ì‹œ ìˆ˜ì˜ì‚¬ì™€ ìƒë‹´í•˜ì„¸ìš”.

[ì´ë¯¸ì§€ 6ë²ˆ: {name} ì¤‘ë…ì¦ìƒ ì¸í¬ê·¸ë˜í”½]

## ğŸ¥ ì‘ê¸‰ ëŒ€ì²˜ë²•

1. ë‹¹í™©í•˜ì§€ ë§ê³  ì„­ì·¨ëŸ‰ íŒŒì•…
2. ê°•ì•„ì§€ ìƒíƒœ ê´€ì°°
3. ìˆ˜ì˜ì‚¬ì—ê²Œ ì¦‰ì‹œ ì—°ë½
4. êµ¬í†  ìœ ë°œì€ ìˆ˜ì˜ì‚¬ ì§€ì‹œ í›„ì—ë§Œ
5. ë³‘ì› ë°©ë¬¸ ì‹œ ì„­ì·¨í•œ ìŒì‹ ì •ë³´ ì „ë‹¬

[ì´ë¯¸ì§€ 7ë²ˆ: {name} ì‘ê¸‰ëŒ€ì²˜ ì¸í¬ê·¸ë˜í”½]

## âœ… ì•ˆì „í•œ ëŒ€ì•ˆ ì‹í’ˆ

{name} ëŒ€ì‹  ì´ëŸ° ìŒì‹ì„ ê³ ë ¤í•´ë³´ì„¸ìš”:

{chr(10).join(alt_lines)}

ì•ˆì „í•œ ê°„ì‹ìœ¼ë¡œ ìš°ë¦¬ ì•„ì´ ê±´ê°•ì„ ì§€ì¼œì£¼ì„¸ìš”.

[ì´ë¯¸ì§€ 8ë²ˆ: {name} ëŒ€ì•ˆì‹í’ˆ ì¸í¬ê·¸ë˜í”½]

## â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

Q1. {name}ì„ ì¡°ê¸ˆë§Œ ë¨¹ì—ˆëŠ”ë° ê´œì°®ì„ê¹Œìš”?
A1. ì†ŒëŸ‰ì´ë¼ë„ ì¦ìƒì„ 24ì‹œê°„ ê´€ì°°í•˜ì„¸ìš”. ì´ìƒ ì¦ìƒ ì‹œ ì¦‰ì‹œ ë³‘ì› ë°©ë¬¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤.

Q2. {name}ì„ ë¨¹ê³  í† í–ˆì–´ìš”.
A2. êµ¬í† ëŠ” ë°©ì–´ ë°˜ì‘ì¼ ìˆ˜ ìˆì–´ìš”. ì¶”ê°€ ì¦ìƒì´ ì—†ëŠ”ì§€ ê´€ì°°í•˜ê³  ìˆ˜ì˜ì‚¬ì™€ ìƒë‹´í•˜ì„¸ìš”.

Q3. ì˜ˆì „ì— {name}ì„ ì¤¬ëŠ”ë° ê´œì°®ì•˜ì–´ìš”.
A3. ê°œì²´ ì°¨ì´ê°€ ìˆì§€ë§Œ, ì¥ê¸°ì ìœ¼ë¡œ ê±´ê°•ì— ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆì–´ìš”. ì•ìœ¼ë¡œëŠ” ê¸‰ì—¬ë¥¼ í”¼í•´ì£¼ì„¸ìš”.

[ì´ë¯¸ì§€ 9ë²ˆ: í–‡ì‚´ì´ ë§ˆë¬´ë¦¬ CTA ì´ë¯¸ì§€]

ì˜¤ëŠ˜ë„ ìš°ë¦¬ ì•„ì´ ê±´ê°• ì±™ê¸°ëŠ” ë³´í˜¸ìë‹˜ë“¤ ì‘ì›í•©ë‹ˆë‹¤! ğŸ’•
ê¶ê¸ˆí•œ ì ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.

ğŸ’¬ ì´ìƒ ì¦ìƒ ë°œê²¬ ì‹œ ì¦‰ì‹œ ìˆ˜ì˜ì‚¬ ì„ ìƒë‹˜ê³¼ ìƒë‹´í•˜ì„¸ìš”!
ğŸ’¬ ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ ì €ì¥í•˜ê³  ê³µìœ í•´ì£¼ì„¸ìš”!

í–‡ì‚´ì´ì™€ í•¨ê»˜í•˜ëŠ” 11ë…„, ì•ìœ¼ë¡œë„ ê±´ê°•í•œ ì •ë³´ë¡œ ì°¾ì•„ëµê²Œìš”. ğŸ¾

#ê°•ì•„ì§€{name} #ê°œ{name} #{name}ê¸‰ì—¬ê¸ˆì§€ #ê°•ì•„ì§€ìŒì‹ì£¼ì˜ #ë°˜ë ¤ê²¬ê±´ê°• #ê°•ì•„ì§€ë¨¹ìœ¼ë©´ì•ˆë˜ëŠ”ìŒì‹ #ê°œë¨¹ìœ¼ë©´ì•ˆë˜ëŠ”ìŒì‹ #ë°˜ë ¤ê²¬ì£¼ì˜ìŒì‹ #í«í‘¸ë“œ #ê°•ì•„ì§€ê±´ê°• #ë°˜ë ¤ê²¬ê±´ê°• #í«ì˜ì–‘ #í–‡ì‚´ì´ë„¤ #ê°•ì•„ì§€ìŒì‹ #ë°˜ë ¤ê²¬ìŒì‹
'''
    return caption.strip()


def generate_forbidden_caption(food: dict) -> str:
    """FORBIDDEN ìº¡ì…˜ ìƒì„±"""
    name = food["name"]
    emoji = EMOJI["FORBIDDEN"]
    hooking = HOOKING["FORBIDDEN"]

    # ë…ì„± ë©”ì»¤ë‹ˆì¦˜
    toxicity = food.get("toxicity", [])
    toxicity_lines = []
    for t in toxicity[:3]:
        toxicity_lines.append(f"â€¢ {t.get('name', 'ë…ì„± ì„±ë¶„')}: {t.get('effect', 'ì‹¬ê°í•œ ìœ„í—˜')}")
    if not toxicity_lines:
        toxicity_lines = ["â€¢ ê°•ì•„ì§€ì—ê²Œ ì¹˜ëª…ì ì¸ ë…ì„± ì„±ë¶„ í¬í•¨", "â€¢ ì†ŒëŸ‰ìœ¼ë¡œë„ ì‹¬ê°í•œ ê±´ê°• ë¬¸ì œ ìœ ë°œ"]

    # ì¤‘ë… ì¦ìƒ
    symptoms = food.get("symptoms", [])
    symptom_lines = []
    for s in symptoms[:5]:
        symptom_lines.append(f"â€¢ {s}")
    if not symptom_lines:
        symptom_lines = ["â€¢ êµ¬í† ", "â€¢ ì„¤ì‚¬", "â€¢ ê²½ë ¨", "â€¢ í˜¸í¡ ê³¤ë€", "â€¢ ì˜ì‹ ì €í•˜"]

    # ìˆ¨ì€ ìœ„í—˜
    hidden_dangers = food.get("hidden_dangers", [])
    hidden_lines = []
    for h in hidden_dangers[:4]:
        hidden_lines.append(f"â€¢ {h}")
    if not hidden_lines:
        hidden_lines = ["â€¢ ê°€ê³µì‹í’ˆì— ìˆ¨ì–´ìˆì„ ìˆ˜ ìˆìŒ", "â€¢ ì–‘ë…ì´ë‚˜ ì†ŒìŠ¤ì— í¬í•¨ë  ìˆ˜ ìˆìŒ", "â€¢ ë‹¤ë¥¸ ìŒì‹ê³¼ ì„ì—¬ìˆì„ ìˆ˜ ìˆìŒ"]

    caption = f'''"{name}", ê°•ì•„ì§€í•œí…Œ ì¤˜ë„ ë ê¹Œ? â›” {hooking}

[ì´ë¯¸ì§€ 1ë²ˆ: í–‡ì‚´ì´ì™€ {name} í‘œì§€]

ì•ˆë…•í•˜ì„¸ìš”, í–‡ì‚´ì´ë„¤ì…ë‹ˆë‹¤! ğŸ•
ì˜¤ëŠ˜ì€ ë°˜ë“œì‹œ ì•Œì•„ì•¼ í•  '{name}' ê¸‰ì—¬ì— ëŒ€í•´ ì•Œë ¤ë“œë¦´ê²Œìš”.
11ì‚´ ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„ í–‡ì‚´ì´ë¥¼ í‚¤ìš°ë©´ì„œ ì–»ì€ ê²½í—˜ê³¼ ìˆ˜ì˜ì‚¬ ì„ ìƒë‹˜ì˜ ì¡°ì–¸ì„ ë°”íƒ•ìœ¼ë¡œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

[ì´ë¯¸ì§€ 2ë²ˆ: {name} ìŒì‹ ì‚¬ì§„]

## â›” {name}, ì ˆëŒ€ ì£¼ì§€ ë§ˆì„¸ìš”!

{name}ì€ ê°•ì•„ì§€ì—ê²Œ ë§¤ìš° ìœ„í—˜í•œ ìŒì‹ì´ì—ìš”. ì†ŒëŸ‰ìœ¼ë¡œë„ ì‹¬ê°í•œ ê±´ê°• ë¬¸ì œë¥¼ ì¼ìœ¼í‚¬ ìˆ˜ ìˆì–´ì„œ ì ˆëŒ€ ê¸‰ì—¬í•´ì„œëŠ” ì•ˆ ë©ë‹ˆë‹¤.

[ì´ë¯¸ì§€ 3ë²ˆ: í–‡ì‚´ì´ì™€ {name} í•¨ê»˜]

## ğŸ”¬ ë…ì„± ë©”ì»¤ë‹ˆì¦˜

{name}ì´ ê°•ì•„ì§€ì—ê²Œ ìœ„í—˜í•œ ì´ìœ :

{chr(10).join(toxicity_lines)}

ì´ëŸ¬í•œ ì„±ë¶„ë“¤ì´ ê°•ì•„ì§€ì˜ ìƒëª…ì„ ìœ„í˜‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

[ì´ë¯¸ì§€ 4ë²ˆ: {name} ë…ì„±ë©”ì»¤ë‹ˆì¦˜ ì¸í¬ê·¸ë˜í”½]

## {emoji} ê²°ë¡ : {name}, ê°•ì•„ì§€ ì ˆëŒ€ ê¸‰ì—¬ ê¸ˆì§€!

{name}ì€ ì–´ë–¤ ìƒí™©ì—ì„œë„ ê°•ì•„ì§€ì—ê²Œ ê¸‰ì—¬í•´ì„œëŠ” ì•ˆ ë˜ëŠ” ìŒì‹ì´ì—ìš”.
ì‹¤ìˆ˜ë¡œ ì„­ì·¨í–ˆë‹¤ë©´ ì¦‰ì‹œ ë™ë¬¼ë³‘ì›ì„ ë°©ë¬¸í•˜ì„¸ìš”.

â›” ì ˆëŒ€ ê¸ˆì§€
â€¢ ì–´ë–¤ í˜•íƒœë¡œë“  ê¸‰ì—¬ ê¸ˆì§€
â€¢ ì¡°ë¦¬í•´ë„ ë…ì„± ì œê±° ì•ˆ ë¨
â€¢ ì†ŒëŸ‰ë„ ìœ„í—˜í•¨
â€¢ ê°•ì•„ì§€ ì ‘ê·¼ ì°¨ë‹¨ í•„ìˆ˜

[ì´ë¯¸ì§€ 5ë²ˆ: {name} ìˆ¨ì€ìœ„í—˜ ì¸í¬ê·¸ë˜í”½]

## ğŸš¨ ì¤‘ë… ì¦ìƒ (ìƒì„¸)

{name}ì„ ì„­ì·¨í–ˆì„ ë•Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆëŠ” ì¦ìƒ:

{chr(10).join(symptom_lines)}

ìœ„ ì¦ìƒì´ í•˜ë‚˜ë¼ë„ ë‚˜íƒ€ë‚˜ë©´ ì¦‰ì‹œ ë™ë¬¼ë³‘ì›ìœ¼ë¡œ ì´ë™í•˜ì„¸ìš”.

[ì´ë¯¸ì§€ 6ë²ˆ: {name} ì¤‘ë…ì¦ìƒ ì¸í¬ê·¸ë˜í”½]

## ğŸ¥ ì‘ê¸‰ ëŒ€ì²˜ë²•

1. ì¦‰ì‹œ ë™ë¬¼ë³‘ì›ì— ì—°ë½í•˜ì„¸ìš”
2. ì„­ì·¨ëŸ‰ê³¼ ì‹œê°„ì„ íŒŒì•…í•˜ì„¸ìš”
3. ì„ì˜ë¡œ êµ¬í† ë¥¼ ìœ ë°œí•˜ì§€ ë§ˆì„¸ìš”
4. ë‚¨ì€ ìŒì‹ì´ ìˆë‹¤ë©´ ë³‘ì›ì— ê°€ì ¸ê°€ì„¸ìš”
5. ê°•ì•„ì§€ë¥¼ ì•ˆì •ì‹œí‚¤ê³  ì´ë™í•˜ì„¸ìš”

ì‘ê¸‰ ìƒí™©ì—ì„œëŠ” ë§ì„¤ì´ì§€ ë§ê³  ë°”ë¡œ ë³‘ì›ìœ¼ë¡œ ê°€ì„¸ìš”.

[ì´ë¯¸ì§€ 7ë²ˆ: {name} ì‘ê¸‰ëŒ€ì²˜ ì¸í¬ê·¸ë˜í”½]

## âš ï¸ ìˆ¨ì–´ìˆëŠ” ìœ„í—˜

{name}ì´ ìˆ¨ì–´ìˆì„ ìˆ˜ ìˆëŠ” ê³³:

{chr(10).join(hidden_lines)}

í•­ìƒ ì„±ë¶„í‘œë¥¼ í™•ì¸í•˜ê³ , ê°•ì•„ì§€ê°€ ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ ë³´ê´€í•˜ì„¸ìš”.

[ì´ë¯¸ì§€ 8ë²ˆ: {name} ê²½ê³ ë©”ì‹œì§€ ì¸í¬ê·¸ë˜í”½]

## â“ ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

Q1. {name}ì„ ì•„ì£¼ ì¡°ê¸ˆë§Œ ë¨¹ì—ˆëŠ”ë° ê´œì°®ì„ê¹Œìš”?
A1. ì†ŒëŸ‰ì´ë¼ë„ ìœ„í—˜í•  ìˆ˜ ìˆì–´ìš”. ì¦‰ì‹œ ë™ë¬¼ë³‘ì›ì— ì—°ë½í•˜ê³  ì¦ìƒì„ ê´€ì°°í•˜ì„¸ìš”.

Q2. ë¨¹ì€ ì§€ ì‹œê°„ì´ ì§€ë‚¬ëŠ”ë° ê´œì°®ì•„ ë³´ì—¬ìš”.
A2. ì¦ìƒì´ ëŠ¦ê²Œ ë‚˜íƒ€ë‚  ìˆ˜ ìˆì–´ìš”. 24~48ì‹œê°„ ê´€ì°°í•˜ê³ , ì¡°ê¸ˆì´ë¼ë„ ì´ìƒí•˜ë©´ ë³‘ì› ë°©ë¬¸í•˜ì„¸ìš”.

Q3. ë‹¤ë¥¸ ì§‘ ê°•ì•„ì§€ëŠ” ë¨¹ì–´ë„ ê´œì°®ë˜ë°ìš”?
A3. ê°œì²´ ì°¨ì´ê°€ ìˆì§€ë§Œ, {name}ì€ ëª¨ë“  ê°•ì•„ì§€ì—ê²Œ ìœ„í—˜í•´ìš”. ìš´ì´ ì¢‹ì•˜ë˜ ê²ƒì¼ ë¿ì´ì—ìš”.

[ì´ë¯¸ì§€ 9ë²ˆ: í–‡ì‚´ì´ ë§ˆë¬´ë¦¬ CTA ì´ë¯¸ì§€]

ì˜¤ëŠ˜ë„ ìš°ë¦¬ ì•„ì´ ê±´ê°• ì±™ê¸°ëŠ” ë³´í˜¸ìë‹˜ë“¤ ì‘ì›í•©ë‹ˆë‹¤! ğŸ’•
ê¶ê¸ˆí•œ ì ì€ ëŒ“ê¸€ë¡œ ë‚¨ê²¨ì£¼ì„¸ìš”.

ğŸ’¬ ì´ìƒ ì¦ìƒ ë°œê²¬ ì‹œ ì¦‰ì‹œ ë™ë¬¼ë³‘ì›ì„ ë°©ë¬¸í•˜ì„¸ìš”!
ğŸ’¬ ì´ ê¸€ì´ ë„ì›€ì´ ë˜ì…¨ë‹¤ë©´ ì €ì¥í•˜ê³  ê³µìœ í•´ì£¼ì„¸ìš”!

í–‡ì‚´ì´ì™€ í•¨ê»˜í•˜ëŠ” 11ë…„, ì•ìœ¼ë¡œë„ ê±´ê°•í•œ ì •ë³´ë¡œ ì°¾ì•„ëµê²Œìš”. ğŸ¾

#ê°•ì•„ì§€{name} #ê°œ{name} #{name}ê¸‰ì—¬ê¸ˆì§€ #ê°•ì•„ì§€ë…ì„±ìŒì‹ #ë°˜ë ¤ê²¬ê±´ê°• #ê°•ì•„ì§€ë¨¹ìœ¼ë©´ì•ˆë˜ëŠ”ìŒì‹ #ê°œë¨¹ìœ¼ë©´ì•ˆë˜ëŠ”ìŒì‹ #ë°˜ë ¤ê²¬ì£¼ì˜ìŒì‹ #í«í‘¸ë“œ #ê°•ì•„ì§€ê±´ê°• #ë°˜ë ¤ê²¬ê±´ê°• #í«ì˜ì–‘ #í–‡ì‚´ì´ë„¤ #ê°•ì•„ì§€ìŒì‹ì£¼ì˜ #ë°˜ë ¤ê²¬ìŒì‹ì£¼ì˜
'''
    return caption.strip()


def save_caption(folder: Path, content: str, food_name: str, safety: str):
    """ìº¡ì…˜ ì €ì¥ (ìƒˆ ê²½ë¡œ + OLD ê²½ë¡œ)"""
    # ìƒˆ ê²½ë¡œ
    new_dir = folder / "blog"
    new_dir.mkdir(exist_ok=True)
    new_path = new_dir / "caption.txt"

    # OLD ê²½ë¡œ
    old_dir = folder / "02_Blog"
    old_dir.mkdir(exist_ok=True)

    # ì˜ë¬¸ ì´ë¦„ ì¶”ì¶œ
    folder_parts = folder.name.split("_", 1)
    eng_name = folder_parts[1] if len(folder_parts) > 1 else food_name
    old_path = old_dir / f"{eng_name}_{safety}_Blog_Caption.txt"

    # ì €ì¥
    with open(new_path, "w", encoding="utf-8") as f:
        f.write(content)

    with open(old_path, "w", encoding="utf-8") as f:
        f.write(content)

    return new_path, old_path


def main():
    food_data = load_food_data()

    # FAIL ëª©ë¡ (ê²€ìˆ˜ ê²°ê³¼ì—ì„œ)
    fail_nums = [
        8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
        21, 23, 24, 25, 26,
        90,
        108, 111, 115,
        138, 144,
        153, 154, 157, 158, 159,
        161, 162, 163, 164, 165, 166,
        168, 169, 170, 171
    ]

    print("=" * 60)
    print("ğŸ“ ë¸”ë¡œê·¸ ìº¡ì…˜ ë°°ì¹˜ ì¬ìƒì„±")
    print("=" * 60)

    success = 0
    failed = 0

    for num in fail_nums:
        food = food_data.get(str(num), {})
        if not food:
            print(f"  âŒ {num:03d}: food_data ì—†ìŒ")
            failed += 1
            continue

        safety = food.get("safety", "SAFE")
        name = food.get("name", f"ìŒì‹{num}")

        folder = get_folder(num)
        if not folder:
            print(f"  âŒ {num:03d}: í´ë” ì—†ìŒ")
            failed += 1
            continue

        # ì•ˆì „ë„ë³„ ìº¡ì…˜ ìƒì„±
        if safety in ["SAFE", "CAUTION"]:
            caption = generate_safe_caution_caption(food, safety)
        elif safety == "DANGER":
            caption = generate_danger_caption(food)
        else:  # FORBIDDEN
            caption = generate_forbidden_caption(food)

        # ê¸€ììˆ˜ ì²´í¬
        char_count = len(caption)
        if char_count < 1620 or char_count > 1980:
            print(f"  âš ï¸ {num:03d} {name}: ê¸€ììˆ˜ {char_count} (ë²”ìœ„ ì™¸) - ì¡°ì • í•„ìš”")

        # ì €ì¥
        new_path, old_path = save_caption(folder, caption, name, safety)
        print(f"  âœ… {num:03d} {name} ({safety}): {char_count}ì")
        success += 1

    print("\n" + "=" * 60)
    print(f"ğŸ“Š ê²°ê³¼: ì„±ê³µ {success}ê±´, ì‹¤íŒ¨ {failed}ê±´")
    print("=" * 60)

if __name__ == "__main__":
    main()
