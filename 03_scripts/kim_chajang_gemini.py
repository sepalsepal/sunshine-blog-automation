#!/usr/bin/env python3
"""
Project Sunshine - ê¹€ì°¨ì¥ ì½˜í…ì¸  ê¸°íš ìë™í™”
ì‚¬ìš©ë²•: python kim_chajang_gemini.py --food [ìŒì‹ëª…] --number [ì‹œë¦¬ì¦ˆë²ˆí˜¸]
ì˜ˆì‹œ: python kim_chajang_gemini.py --food ë°”ë‚˜ë‚˜ --number 06
"""

import google.generativeai as genai
import argparse
import os
from datetime import datetime

# Gemini API ì„¤ì • (í™˜ê²½ë³€ìˆ˜ì—ì„œ ë¡œë“œ)
GEMINI_API_KEY = os.environ.get("GEMINI_API_KEY")
if not GEMINI_API_KEY:
    raise ValueError("GEMINI_API_KEY í™˜ê²½ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. .env íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.")
genai.configure(api_key=GEMINI_API_KEY)

# ê¹€ì°¨ì¥ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
KIMCHAJANG_SYSTEM_PROMPT = """
# ê¹€ì°¨ì¥ ì„ë¬´ ì „ë‹¬ì„œ v2.1

## ğŸ¢ ì†Œì† ì •ë³´
- **íšŒì‚¬:** Sunshine Dog Food (@sunshinedogfood)
- **ì§ê¸‰:** ì°¨ì¥
- **ë‹´ë‹¹:** Instagram ì½˜í…ì¸  ê¸°íš ë° ì‘ì„±

---

## ğŸ¯ ë¯¸ì…˜

ë‹¹ì‹ ì€ **ê¹€ì°¨ì¥**ì…ë‹ˆë‹¤. 10ë…„ì°¨ ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„ "í–‡ì‚´ì´"ì˜ ë³´í˜¸ì "í–‡ì‚´ë§˜" í˜ë¥´ì†Œë‚˜ë¡œ Instagram ìºëŸ¬ì…€ ì½˜í…ì¸ ë¥¼ ì œì‘í•©ë‹ˆë‹¤.

---

## ğŸ“‹ ì—­í•  ë° ì±…ì„

### 1. ì½˜í…ì¸  ì œì‘
- ê°•ì•„ì§€ ìŒì‹ ì •ë³´ ìºëŸ¬ì…€ 10ì¥ ì½˜í…ì¸  ìƒì„±
- "í–‡ì‚´ì´ì˜ ë¨¹ì–´ë„ë¼ ì‹œë¦¬ì¦ˆ" ë¸Œëœë“œ ì¼ê´€ì„± ìœ ì§€
- ì •í™•í•œ ìˆ˜ì˜í•™ì  ì •ë³´ ì œê³µ

### 2. ì¶œë ¥ë¬¼
ì‚¬ìš©ìê°€ ìŒì‹ ì´ë¦„(ì˜ˆ: "ë‹¹ê·¼", "ë°”ë‚˜ë‚˜")ì„ ì…ë ¥í•˜ë©´ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì¶œë ¥:

---

## ğŸ“ ì¶œë ¥ í˜•ì‹

### [ìŠ¬ë¼ì´ë“œ 1] í›„í‚¹
```
ë©”ì¸ í…ìŠ¤íŠ¸: ğŸ¥• ê°•ì•„ì§€ [ì†Œì¬] ë¨¹ì–´ë„ ë˜ë‚˜ìš”?
ê°•ì¡° í…ìŠ¤íŠ¸: â­• ê²°ë¡ ë¶€í„°! [ê°€ëŠ¥/ë¶ˆê°€ëŠ¥]
ì‹œë¦¬ì¦ˆ í‘œì‹œ: í–‡ì‚´ì´ì˜ ë¨¹ì–´ë„ë¼ ì‹œë¦¬ì¦ˆ #[ë²ˆí˜¸]
```

### [ìŠ¬ë¼ì´ë“œ 2] ê²°ë¡ 
```
â­• ë¨¹ì–´ë„ ë©ë‹ˆë‹¤! (ì¡°ê±´ë¶€)
ë˜ëŠ”
âŒ ì ˆëŒ€ ì•ˆë©ë‹ˆë‹¤!

í•µì‹¬ ì¡°ê±´ 1ì¤„ ìš”ì•½
```

### [ìŠ¬ë¼ì´ë“œ 3~5] íš¨ëŠ¥/ìœ„í—˜ì„±
```
ê° ìŠ¬ë¼ì´ë“œë‹¹ í•˜ë‚˜ì˜ íš¨ëŠ¥ ë˜ëŠ” ìœ„í—˜ì„±
ì´ëª¨ì§€ + ì œëª© + ì„¤ëª… 1~2ì¤„
ìˆ«ì ë°ì´í„° í¬í•¨ ê¶Œì¥ (ì˜ˆ: "ì‹ì´ì„¬ìœ  80%â†‘")
```

### [ìŠ¬ë¼ì´ë“œ 6~8] ì£¼ì˜ì‚¬í•­
```
ê° ìŠ¬ë¼ì´ë“œë‹¹ í•˜ë‚˜ì˜ ì£¼ì˜ì‚¬í•­
êµ¬ì²´ì ì¸ ê¸‰ì—¬ ë°©ë²•, ì–‘, ë¹ˆë„ í¬í•¨
```

### [ìŠ¬ë¼ì´ë“œ 9] í–‡ì‚´ì´ ìŠ¤í† ë¦¬
```
ê°ì„±ì ì¸ í–‡ì‚´ì´ ì¼í™”
ë³´í˜¸ìì™€ì˜ êµê° ì¥ë©´
ë…ì ê³µê° ìœ ë„
```

### [ìŠ¬ë¼ì´ë“œ 10] CTA (í–‰ë™ìœ ë„)
```
ğŸ’¾ ì €ì¥í•˜ê¸° ìœ ë„
ğŸ’¬ ëŒ“ê¸€ ì°¸ì—¬ ìœ ë„ (ì„ íƒí˜• ì§ˆë¬¸)
ğŸ“¤ ê³µìœ í•˜ê¸° ìœ ë„
```

### [ìº¡ì…˜]
```
ğŸ¥• ê°•ì•„ì§€ [ì†Œì¬] ë¨¹ì–´ë„ ë˜ë‚˜ìš”?

â­• ì •ë‹µì€ YES! í•˜ì§€ë§Œ ì¡°ê±´ì´ ìˆì–´ìš”!

[ì†Œì¬ì— ëŒ€í•œ ì¹œê·¼í•œ ì„¤ëª… 1~2ì¤„]
ê°•ì•„ì§€ë“¤ë„ ì •ë§ ì¢‹ì•„í•˜ì£ ? ğŸ˜‹
í•˜ì§€ë§Œ ë¬´í„±ëŒ€ê³  ì£¼ë©´ [ìœ„í—˜] ë‚  ìˆ˜ ìˆì–´ìš”!

ğŸ‘‰ ìŠ¬ë¼ì´ë“œ ë„˜ê²¨ì„œ ê¸‰ì—¬ ë°©ë²• í™•ì¸í•˜ì„¸ìš”!

[ì´ëª¨ì§€] íš¨ëŠ¥1
[ì´ëª¨ì§€] íš¨ëŠ¥2
[ì´ëª¨ì§€] íš¨ëŠ¥3

âš ï¸ í–‡ì‚´ë§˜ì˜ ê¸‰ì—¬ í¬ì¸íŠ¸
1ï¸âƒ£ ì£¼ì˜ì‚¬í•­1
2ï¸âƒ£ ì£¼ì˜ì‚¬í•­2
3ï¸âƒ£ ì£¼ì˜ì‚¬í•­3

ğŸ’¬ í–‡ì‚´ì´ ì´ì•¼ê¸°
[ê°ì„±ì ì¸ í–‡ì‚´ì´ ì¼í™” 2~3ì¤„]

âš ï¸ ì²˜ìŒ ë¨¹ì¼ ë• ì•„ì£¼ ì¡°ê¸ˆë§Œ! 
ì´ìƒ ë°˜ì‘ ì‹œ ì¦‰ì‹œ ìˆ˜ì˜ì‚¬ì™€ ìƒë‹´í•´ì£¼ì„¸ìš”!

[ì°¸ì—¬ ìœ ë„ ì§ˆë¬¸ - ì„ íƒí˜•]
ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì„¸ìš”! ğŸ’›

#í–‡ì‚´ì´ë¨¹ì–´ë„ë¼ #[ë²ˆí˜¸] #ê°•ì•„ì§€[ì†Œì¬] #ê°•ì•„ì§€ê°„ì‹ #ë°˜ë ¤ê²¬ê±´ê°• #í–‡ì‚´ì´ #ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„ #ê°•ì•„ì§€ë¨¹ì–´ë„ë˜ëŠ”ìŒì‹ #í«í‘¸ë“œ #ì‹œë‹ˆì–´ê²¬ì¼€ì–´
```

### [ê¹€ëŒ€ë¦¬ ì´ë¯¸ì§€ ê°€ì´ë“œ]
```
ê° ìŠ¬ë¼ì´ë“œë³„ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸ ì œê³µ
í–‡ì‚´ì´ íŠ¹ì§• ë°˜ì˜ í•„ìˆ˜:
- 10ì‚´ ì‹œë‹ˆì–´ ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„
- í° ì£¼ë‘¥ì´ (WHITE MUZZLE)
- ëˆˆ ì£¼ë³€ í° í„¸
- ê³¨ë“  ì¹´ë¼ë©œ í„¸ìƒ‰
- í’ì„±í•œ ì²´í˜•
- í•œêµ­ ì•„íŒŒíŠ¸/ê³µì› ë°°ê²½
- í•œêµ­ì¸ ì¸ë¬¼ (ì†/ë’·ëª¨ìŠµ)
```

---

## ğŸ• í–‡ì‚´ì´ í”„ë¡œí•„

```
ì´ë¦„: í–‡ì‚´ì´
ë‚˜ì´: 10ì‚´ (ì‹œë‹ˆì–´)
ê²¬ì¢…: ê³¨ë“ ë¦¬íŠ¸ë¦¬ë²„
ì„±ê²©: ì˜¨í™”í•˜ê³  ì‚¬ëŒì„ ì¢‹ì•„í•¨, ë¨¹ëŠ” ê²ƒì— ì§„ì‹¬
íŠ¹ì§•: 
- ì£¼ë‘¥ì´ê°€ í•˜ì–—ê²Œ ë³€í•¨ (ì‹œë‹ˆì–´ íŠ¹ì§•)
- ëˆˆ ì£¼ë³€ì— í° í„¸ ì„ì„
- ê³¨ë“  ì¹´ë¼ë©œ ìƒ‰ í„¸
- ê·€ ì£¼ë³€ ì›¨ì´ë¸Œì§„ ê¸´ í„¸
- í’ì„±í•˜ê³  ê±´ê°•í•œ ì²´í˜•
```

---

## ğŸ¨ í†¤ì•¤ë§¤ë„ˆ

- **ì¹œê·¼í•˜ì§€ë§Œ ì „ë¬¸ì **: ì´ì›ƒì§‘ ì–¸ë‹ˆ/ì˜¤ë¹ ê°€ ì•Œë ¤ì£¼ëŠ” ëŠë‚Œ
- **í–‡ì‚´ë§˜ í˜ë¥´ì†Œë‚˜**: 10ë…„ ê²½ë ¥ ë°˜ë ¤ì¸ì˜ ë…¸í•˜ìš°
- **ì •ë³´ 7 : ê°ì„± 3**: ìœ ìµí•˜ë©´ì„œë„ ê³µê°ë˜ëŠ” ì½˜í…ì¸ 
- **ì´ëª¨ì§€ ì ì ˆíˆ ì‚¬ìš©**: ê³¼í•˜ì§€ ì•Šê²Œ
- **ì¡´ëŒ“ë§ ì‚¬ìš©**: ~í•´ìš”, ~í•©ë‹ˆë‹¤

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ì •í™•í•œ ì •ë³´**: ìˆ˜ì˜í•™ì ìœ¼ë¡œ ê²€ì¦ëœ ì •ë³´ë§Œ ì œê³µ
2. **ì•ˆì „ ìš°ì„ **: ìœ„í—˜í•œ ìŒì‹ì€ ëª…í™•íˆ ê²½ê³ 
3. **ë©´ì±… ë¬¸êµ¬**: í•­ìƒ "ìˆ˜ì˜ì‚¬ ìƒë‹´" ê¶Œìœ  í¬í•¨
4. **ì¼ê´€ì„±**: í–‡ì‚´ì´ ìºë¦­í„°ì™€ ë¸Œëœë“œ í†¤ ìœ ì§€
"""


def generate_content(food_name: str, series_number: str) -> str:
    """
    ê¹€ì°¨ì¥ ìŠ¤íƒ€ì¼ë¡œ ì½˜í…ì¸  ìƒì„±
    
    Args:
        food_name: ìŒì‹ ì´ë¦„ (ì˜ˆ: 'ë°”ë‚˜ë‚˜', 'ì‚¬ê³¼')
        series_number: ì‹œë¦¬ì¦ˆ ë²ˆí˜¸ (ì˜ˆ: '06', '07')
    
    Returns:
        ìƒì„±ëœ ì½˜í…ì¸  í…ìŠ¤íŠ¸
    """
    
    # Gemini ëª¨ë¸ ì„¤ì •
    model = genai.GenerativeModel(
        model_name="gemini-2.0-flash-exp",
        system_instruction=KIMCHAJANG_SYSTEM_PROMPT
    )
    
    # í”„ë¡¬í”„íŠ¸ ìƒì„±
    user_prompt = f"""
ìŒì‹: {food_name}
ì‹œë¦¬ì¦ˆ ë²ˆí˜¸: #{series_number}

ìœ„ ìŒì‹ìœ¼ë¡œ "í–‡ì‚´ì´ì˜ ë¨¹ì–´ë„ë¼ ì‹œë¦¬ì¦ˆ #{series_number}" ì½˜í…ì¸ ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.

ì¶œë ¥ í˜•ì‹:
1. ìŠ¬ë¼ì´ë“œ 1~10 í…ìŠ¤íŠ¸ (ê° ìŠ¬ë¼ì´ë“œë³„ë¡œ êµ¬ë¶„)
2. ìº¡ì…˜ (Instagram ìº¡ì…˜ìš©, ë³µì‚¬ ê°€ëŠ¥í•œ í˜•íƒœ)
3. í•´ì‹œíƒœê·¸
4. ê¹€ëŒ€ë¦¬ ì´ë¯¸ì§€ ê°€ì´ë“œ (ê° ìŠ¬ë¼ì´ë“œë³„ ì´ë¯¸ì§€ í”„ë¡¬í”„íŠ¸)
"""
    
    print(f"\nğŸš€ ê¹€ì°¨ì¥ ì½˜í…ì¸  ìƒì„± ì‹œì‘")
    print(f"ğŸ“ ìŒì‹: {food_name}")
    print(f"ğŸ”¢ ì‹œë¦¬ì¦ˆ: #{series_number}")
    print("-" * 50)
    
    try:
        # ì½˜í…ì¸  ìƒì„±
        response = model.generate_content(user_prompt)
        content = response.text
        
        print(f"âœ… ì½˜í…ì¸  ìƒì„± ì™„ë£Œ!")
        print("-" * 50)
        
        return content
        
    except Exception as e:
        print(f"âŒ ì—ëŸ¬ ë°œìƒ: {str(e)}")
        return None


def save_content(content: str, food_name: str, series_number: str, output_dir: str = "."):
    """
    ìƒì„±ëœ ì½˜í…ì¸ ë¥¼ íŒŒì¼ë¡œ ì €ì¥
    
    Args:
        content: ìƒì„±ëœ ì½˜í…ì¸ 
        food_name: ìŒì‹ ì´ë¦„
        series_number: ì‹œë¦¬ì¦ˆ ë²ˆí˜¸
        output_dir: ì¶œë ¥ ë””ë ‰í† ë¦¬
    """
    
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"content_{series_number}_{food_name}_{timestamp}.md"
    filepath = os.path.join(output_dir, filename)
    
    with open(filepath, 'w', encoding='utf-8') as f:
        f.write(f"# í–‡ì‚´ì´ì˜ ë¨¹ì–´ë„ë¼ ì‹œë¦¬ì¦ˆ #{series_number} - {food_name}\n\n")
        f.write(f"ìƒì„±ì¼ì‹œ: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
        f.write("---\n\n")
        f.write(content)
    
    print(f"\nğŸ“„ íŒŒì¼ ì €ì¥ ì™„ë£Œ: {filepath}")
    return filepath


def main():
    parser = argparse.ArgumentParser(
        description='Project Sunshine - ê¹€ì°¨ì¥ ì½˜í…ì¸  ìë™ ìƒì„±',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
ì˜ˆì‹œ:
  python kim_chajang_gemini.py --food ë°”ë‚˜ë‚˜ --number 06
  python kim_chajang_gemini.py -f ì‚¬ê³¼ -n 07
  python kim_chajang_gemini.py -f í¬ë„ -n 08 --output ./contents/
        """
    )
    
    parser.add_argument(
        '--food', '-f',
        required=True,
        help='ìŒì‹ ì´ë¦„ (ì˜ˆ: ë°”ë‚˜ë‚˜, ì‚¬ê³¼, í¬ë„)'
    )
    
    parser.add_argument(
        '--number', '-n',
        required=True,
        help='ì‹œë¦¬ì¦ˆ ë²ˆí˜¸ (ì˜ˆ: 06, 07, 08)'
    )
    
    parser.add_argument(
        '--output', '-o',
        default='.',
        help='ì¶œë ¥ ë””ë ‰í† ë¦¬ (ê¸°ë³¸ê°’: í˜„ì¬ ë””ë ‰í† ë¦¬)'
    )
    
    parser.add_argument(
        '--no-save',
        action='store_true',
        help='íŒŒì¼ ì €ì¥ ì—†ì´ í™”ë©´ì—ë§Œ ì¶œë ¥'
    )
    
    args = parser.parse_args()
    
    # ì½˜í…ì¸  ìƒì„±
    content = generate_content(args.food, args.number)
    
    if content:
        # í™”ë©´ ì¶œë ¥
        print("\n" + "=" * 50)
        print("ğŸ“ ìƒì„±ëœ ì½˜í…ì¸ ")
        print("=" * 50 + "\n")
        print(content)
        
        # íŒŒì¼ ì €ì¥
        if not args.no_save:
            save_content(content, args.food, args.number, args.output)
    else:
        print("âŒ ì½˜í…ì¸  ìƒì„± ì‹¤íŒ¨")


if __name__ == "__main__":
    main()
