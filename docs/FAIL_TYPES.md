# FAIL 유형 정의 v0.1

> **버전:** v0.1
> **작성일:** 2026-01-31
> **기준 문서:** Project_Sunshine_Execution_Guidebook_v1.1.md

---

## FAIL 유형 (5가지 강제 분류)

| 코드 | 유형 | 설명 | 자동 감지 | 자동 수정 |
|------|------|------|:--------:|:--------:|
| **F1** | 판단 불가 | 정보 부족으로 결정 못함 | ⚠️ 부분 | ❌ |
| **F2** | 기준 충돌 | 두 규칙이 모순 | ❌ | ❌ |
| **F3** | 데이터 부족 | 입력 데이터 미확보 | ✅ | ⚠️ 부분 |
| **F4** | 규칙 위반 | 기존 규칙에 명시적 위배 | ✅ | ✅ |
| **F5** | 반복 실패 | 동일 시도 2회 이상 실패 | ✅ | ❌ (중단) |

---

## F1: 판단 불가

### 정의
- 정보가 부족하여 결정을 내릴 수 없는 상태
- 에이전트가 판단에 필요한 데이터를 찾을 수 없음

### 예시
```
- 음식 안전성 정보가 신뢰할 수 있는 출처에서 확인 불가
- 급여량 기준 데이터 없음
- 이미지 품질 판단 기준 불명확
```

### 처리 방법
```
1. FAIL 선언 + "F1: [구체적 사유]"
2. 재시도 전략: 추가 정보 소스 검색
3. 3회 누적 시 자동 중단
```

---

## F2: 기준 충돌 ⚠️ 특례 적용

### 정의
- 두 개 이상의 규칙이 서로 모순되는 상태
- 어느 규칙을 따라야 할지 명확하지 않음

### 예시
```
- CLAUDE.md: "4장 슬라이드" vs 기존 콘텐츠: "7장 슬라이드"
- v1.1 톤: "따뜻한 말투" vs 안전 경고: "단호한 경고"
- 이미지 규칙 충돌
```

### 특례 처리 (v1.1)
```
1. 최초 2회: FAIL 기록 + 계속 진행
2. 3회 누적 시에만 자동 중단
3. Day 7, 14 회복점에서 반드시 리뷰
4. 목적: 설계 미성숙 신호를 "학습 데이터"로 활용
```

---

## F3: 데이터 부족

### 정의
- 입력 데이터가 확보되지 않음
- 필수 파일/정보 누락

### 예시
```
- 텍스트 설정 파일 없음 ({topic}_text.json)
- 배경 이미지 파일 없음
- 캡션 템플릿 누락
- PUBLISHING_LOG.md 미확인
```

### 처리 방법
```
1. FAIL 선언 + "F3: [누락된 데이터 명시]"
2. 재시도 전략: 데이터 생성 또는 기본값 적용
3. 자동 수정 가능한 경우 시도
```

---

## F4: 규칙 위반

### 정의
- 기존 규칙에 명시적으로 위배됨
- 검증 가능한 규칙 불충족

### 예시
```
- AI 표기 누락 (필수 문구 미포함)
- 급여량 형식 불일치 ("소형 | 중형 | 대형" 형식 아님)
- 금지 포즈 사용 (먹기/핥기/만지기)
- 해시태그 개수 초과 (8~12개 범위 이탈)
- 안전도 색상 불일치
```

### 처리 방법
```
1. FAIL 선언 + "F4: [위반 규칙 명시]"
2. 재시도 전략: 규칙에 맞게 자동 수정
3. 자동 수정 가능 → 즉시 수정 후 재검증
```

---

## F5: 반복 실패

### 정의
- 동일한 시도가 2회 이상 실패
- 같은 원인으로 반복적으로 FAIL

### 예시
```
- 이미지 생성 2회 연속 실패
- 텍스트 오버레이 2회 연속 오류
- API 호출 2회 연속 실패
```

### 처리 방법
```
1. FAIL 선언 + "F5: [반복 실패 내용]"
2. 즉시 자동 중단 (재시도 금지)
3. PD님 알림 필수
```

---

## FAIL 선언 필수 출력 형식

```
FAIL-REASON: [F코드] [사유 1줄]
RETRY-STRATEGY: [재시도 전략 1줄]
FAIL-COUNT: [현재 누적 횟수]/3
```

### 예시

```
FAIL-REASON: F4 AI 표기 누락 - 캡션에 필수 문구 미포함
RETRY-STRATEGY: 캡션 하단에 "ℹ️ 일부 이미지는 AI로 생성되었습니다." 추가
FAIL-COUNT: 1/3
```

```
FAIL-REASON: F3 텍스트 설정 파일 없음 - watermelon_text.json 미존재
RETRY-STRATEGY: 기본 템플릿으로 텍스트 설정 파일 생성
FAIL-COUNT: 1/3
```

---

## RF (Red Flag) 레벨 정의 (v0.2 추가)

RF1을 세분화하여 Day 7 리뷰 시 패턴 분석에 활용.

| 레벨 | 정의 | 예시 | 조치 |
|------|------|------|------|
| RF1-A | 브랜드/연출 문제 | salmon (다른 개 등장) | Day 7 리뷰 |
| RF1-B | 의미 오해 가능 | 모호한 표현, 해석 여지 | Day 7 리뷰 + 주의 |
| RF1-C | 정책/안전 경계 | 플랫폼 신고 가능성 | Phase 3 조건 강화 후보 ⚠️ |

### RF1-C 발생 시 자동 트리거

```
RF1-C 1회 이상 발생 → Phase 3 조건 강화 후보로 등록
docs/CHANGELOG.md에 기록 필수
```

### RF 레벨 판단 기준

```
RF1-A (브랜드/연출):
- 햇살이 외 다른 개 등장
- 배경/소품 일관성 깨짐
- 스타일 불일치 (AI vs 실사 혼재)

RF1-B (의미 오해):
- "소량은 괜찮다" 등 해석 여지 있는 표현
- 조건부 안전 정보 불명확
- 톤과 메시지 미묘한 불일치

RF1-C (정책/안전):
- 위험 음식 경고 부족
- 플랫폼 커뮤니티 가이드라인 경계
- 오해 시 건강 위험 가능성
```

---

## 자동 중단 조건

| 조건 | 동작 |
|------|------|
| 동일 FAIL 유형 3회 누적 | 자동 중단 + PD님 알림 |
| F5 (반복 실패) 발생 | 즉시 중단 |
| Agent D Red Flag 2개+ | 즉시 중단 |

### 예외: F2 (기준 충돌)
- 최초 2회는 계속 진행
- 3회 누적 시에만 중단
- Day 7, 14 회복점에서 리뷰

---

## FAIL 데이터 기록

### 기록 위치
- 실시간: Claude Code 내부 메모리
- 영구: docs/FAILURE_MAP.md

### 기록 형식

```markdown
## [날짜] FAIL 기록

| 시간 | Agent | 코드 | 사유 | 재시도 | 결과 |
|------|-------|------|------|--------|------|
| 09:30 | A | F4 | AI 표기 누락 | 문구 추가 | PASS |
| 09:45 | D | F3 | 배경 이미지 없음 | 파일 생성 | PASS |
| 10:00 | B | F2 | 톤 규칙 충돌 | - | 계속 진행 |
```

---

**마지막 업데이트:** 2026-01-31
**버전:** v0.1
