# ì½”ë“œ ì¹˜ëª…ì  ë¦¬ìŠ¤í¬ ì ê²€ ë³´ê³ ì„œ (Draft)

> **ìƒíƒœ:** DRAFT - í™•ì • ì•„ë‹˜
> **ì‘ì„±ì¼:** 2026-01-31 (Day 11 ì•¼ê°„)
> **ì ê²€ ë²”ìœ„:** services/scripts/*.py í•µì‹¬ ìŠ¤í¬ë¦½íŠ¸
> **ì ê²€ í•­ëª©:** ë³´ì•ˆ, ì•ˆì •ì„±, ë°ì´í„° ë¬´ê²°ì„±

---

## ì ê²€ ëŒ€ìƒ íŒŒì¼

| # | íŒŒì¼ | ê²½ë¡œ | ìœ„í—˜ë„ |
|:-:|------|------|:------:|
| 1 | publish_content.py | services/scripts/publishing/ | ğŸ”´ ë†’ìŒ |
| 2 | auto_scheduler.py | services/scripts/ | ğŸŸ¡ ì¤‘ê°„ |
| 3 | generate_images.py | services/scripts/image_generation/ | ğŸŸ¢ ë‚®ìŒ |

---

## 1. publish_content.py - ğŸ”´ ë†’ìŒ

### ê°œìš”
- **ê¸°ëŠ¥:** Instagram + Threads ìºëŸ¬ì…€ ê²Œì‹œ
- **ë¼ì¸ ìˆ˜:** 461ì¤„
- **API ì—°ë™:** Instagram Graph API, Threads API, Cloudinary

### ë°œê²¬ëœ ë¦¬ìŠ¤í¬

#### R1-1. í•˜ë“œì½”ë”©ëœ CONTENT_MAP (ğŸŸ¡ ì¤‘ê°„)

```python
# Line 35-83
CONTENT_MAP = {
    "pumpkin": "001_pumpkin_published",
    "beef": "024_beef_ì†Œê³ ê¸°_ì œì‘ì™„ë£Œ",
    ...
}
```

**ë¦¬ìŠ¤í¬:**
- ì½˜í…ì¸  í´ë”ëª… ë³€ê²½ ì‹œ ìˆ˜ë™ ì—…ë°ì´íŠ¸ í•„ìš”
- ëˆ„ë½ ì‹œ ê²Œì‹œ ì‹¤íŒ¨ ë°œìƒ (Day 11 ì‹¤ì œ ë°œìƒ)

**ê¶Œì¥ ì¡°ì¹˜:**
- í´ë” ìë™ ìŠ¤ìº” ë¡œì§ ë„ì… ê²€í† 
- ë˜ëŠ” config íŒŒì¼ë¡œ ë¶„ë¦¬

#### R1-2. API í† í° ë…¸ì¶œ ê°€ëŠ¥ì„± (ğŸŸ¢ ë‚®ìŒ)

```python
# Line 26-28
THREADS_USER_ID = os.getenv("THREADS_USER_ID")
THREADS_ACCESS_TOKEN = os.getenv("THREADS_ACCESS_TOKEN")
```

**í˜„ì¬ ìƒíƒœ:** `.env` íŒŒì¼ì—ì„œ ë¡œë“œ (ì•ˆì „)
**í™•ì¸:** ì‹œí¬ë¦¿ì´ ì½”ë“œì— í•˜ë“œì½”ë”©ë˜ì§€ ì•ŠìŒ âœ…

#### R1-3. ì¬ì‹œë„ ë¡œì§ ë¬´í•œ ë£¨í”„ ê°€ëŠ¥ì„± (ğŸŸ¡ ì¤‘ê°„)

```python
# Line 360-366
if auto_retry:
    result = await publish_with_retry(topic, topic_kr, do_publish)
```

**ë¦¬ìŠ¤í¬:**
- `publish_with_retry`ì˜ ìµœëŒ€ ì¬ì‹œë„ íšŸìˆ˜ê°€ ì™¸ë¶€ ì„¤ì •ì— ì˜ì¡´
- ì„¤ì • ì˜¤ë¥˜ ì‹œ ë¬´í•œ ì¬ì‹œë„ ê°€ëŠ¥

**í™•ì¸ í•„ìš”:** RetryManagerì˜ MAX_RETRIES ìƒìˆ˜ í™•ì¸

#### R1-4. ë™ì‹œ ê²Œì‹œ ì¶©ëŒ ê°€ëŠ¥ì„± (ğŸŸ¡ ì¤‘ê°„)

```python
# Line 277-437
async def publish_content(topic: str, auto_retry: bool = True):
```

**ë¦¬ìŠ¤í¬:**
- ë™ì¼ ì½˜í…ì¸  ë™ì‹œ ê²Œì‹œ ì‹œë„ ì‹œ ì¤‘ë³µ ê²Œì‹œ ê°€ëŠ¥
- ë½(lock) ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ

**ê¶Œì¥ ì¡°ì¹˜:**
- ê²Œì‹œ ì „ ì¤‘ë³µ ì²´í¬ ë¡œì§ ì¶”ê°€
- íŒŒì¼ ê¸°ë°˜ ë˜ëŠ” ë©”ëª¨ë¦¬ ë½ ë„ì…

### ì ìˆ˜: 75/100 (ê°œì„  í•„ìš”)

---

## 2. auto_scheduler.py - ğŸŸ¡ ì¤‘ê°„

### ê°œìš”
- **ê¸°ëŠ¥:** ìë™ ê²Œì‹œ ìŠ¤ì¼€ì¤„ëŸ¬
- **ë¼ì¸ ìˆ˜:** 640ì¤„
- **ì €ì¥ì†Œ:** JSON íŒŒì¼ (publish_schedule.json)

### ë°œê²¬ëœ ë¦¬ìŠ¤í¬

#### R2-1. JSON íŒŒì¼ ë™ì‹œ ì ‘ê·¼ (ğŸŸ¡ ì¤‘ê°„)

```python
# Line 100-104
def _save_schedule(self):
    self.schedule_file.parent.mkdir(parents=True, exist_ok=True)
    with open(self.schedule_file, 'w', encoding='utf-8') as f:
        json.dump(self.schedule, f, ensure_ascii=False, indent=2)
```

**ë¦¬ìŠ¤í¬:**
- ë™ì‹œ ì‹¤í–‰ ì‹œ íŒŒì¼ ì†ìƒ ê°€ëŠ¥
- ë½ ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ

**ê¶Œì¥ ì¡°ì¹˜:**
- `fcntl.flock()` ë˜ëŠ” `filelock` ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©

#### R2-2. ë‚ ì§œ/ì‹œê°„ íŒŒì‹± ì˜¤ë¥˜ ë¬´ì‹œ (ğŸŸ¢ ë‚®ìŒ)

```python
# Line 176-184
try:
    scheduled_dt = datetime.strptime(
        f"{date_str} {time_str}",
        "%Y-%m-%d %H:%M"
    )
except ValueError:
    continue  # ì˜¤ë¥˜ ë¬´ì‹œ
```

**í˜„ì¬ ìƒíƒœ:** ì˜¤ë¥˜ ë°œìƒ ì‹œ í•´ë‹¹ ìŠ¤ì¼€ì¤„ ìŠ¤í‚µ (ì•ˆì „)
**ê°œì„  ê°€ëŠ¥:** ë¡œê·¸ ê¸°ë¡ ì¶”ê°€

#### R2-3. í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì‹¤íŒ¨ ì‹œ ë¬´ì‹œ (ğŸŸ¢ ë‚®ìŒ)

```python
# Line 569-594
def send_telegram_notification(message: str):
    try:
        ...
    except Exception as e:
        logger.warning(f"í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì˜¤ë¥˜: {e}")
```

**í˜„ì¬ ìƒíƒœ:** ì•Œë¦¼ ì‹¤íŒ¨ê°€ ë©”ì¸ ë¡œì§ì— ì˜í–¥ ì•ˆ ì¤Œ (ì•ˆì „)

#### R2-4. í‘œì§€ ê²½ë¡œ í•˜ë“œì½”ë”© (ğŸŸ¢ ë‚®ìŒ)

```python
# Line 606-607
cover_ready_dir = ROOT / "content/images/000_cover/02_ready"
cover_source_dir = ROOT / "content/images/000_cover/03_cover_sources"
```

**ë¦¬ìŠ¤í¬:** í´ë” êµ¬ì¡° ë³€ê²½ ì‹œ ìˆ˜ë™ ìˆ˜ì • í•„ìš”
**ì˜í–¥:** ë‚®ìŒ (í˜„ì¬ êµ¬ì¡° ê³ ì •)

### ì ìˆ˜: 85/100 (ì–‘í˜¸)

---

## 3. generate_images.py - ğŸŸ¢ ë‚®ìŒ

### ê°œìš”
- **ê¸°ëŠ¥:** FLUX 2.0 Pro ì´ë¯¸ì§€ ìƒì„±
- **ë¼ì¸ ìˆ˜:** 220ì¤„
- **API:** fal.ai

### ë°œê²¬ëœ ë¦¬ìŠ¤í¬

#### R3-1. ëª¨ë¸ ID ê²€ì¦ ê°•í™” (âœ… ìš°ìˆ˜)

```python
# Line 30
MODEL_ID = "fal-ai/flux-2-pro"  # í•˜ë“œì½”ë”© - ë³€ê²½ ê¸ˆì§€

# Line 46-49
def verify_model_id():
    if MODEL_ID != "fal-ai/flux-2-pro":
        raise RuntimeError("â›” ëª¨ë¸ IDê°€ ë³€ì¡°ë˜ì—ˆìŠµë‹ˆë‹¤!")
```

**ìƒíƒœ:** ì´ì¤‘ ê²€ì¦ ì ìš©ë¨ âœ…
**Day 11 ì´ìŠˆ:** ê³¼ê±° ëª¨ë¸ ID ì˜¤ë¥˜ ì¬ë°œ ë°©ì§€ë¨

#### R3-2. API í‚¤ ê²€ì¦ ë¶€ì¬ (ğŸŸ¢ ë‚®ìŒ)

```python
# Line 38-40
FAL_KEY = os.getenv("FAL_KEY")
if FAL_KEY:
    os.environ["FAL_KEY"] = FAL_KEY
```

**ë¦¬ìŠ¤í¬:** FAL_KEY ì—†ì„ ì‹œ ëŸ°íƒ€ì„ ì˜¤ë¥˜ ë°œìƒ
**ì˜í–¥:** ë‚®ìŒ (ëª…í™•í•œ ì˜¤ë¥˜ ë©”ì‹œì§€)

#### R3-3. ì´ë¯¸ì§€ ì €ì¥ ì‹œ ë®ì–´ì“°ê¸° (ğŸŸ¢ ë‚®ìŒ)

```python
# Line 104
img.save(output_path, "PNG", optimize=True)
```

**ë¦¬ìŠ¤í¬:** ê¸°ì¡´ íŒŒì¼ ë¬´ì¡°ê±´ ë®ì–´ì“°ê¸°
**í˜„ì¬ ìƒíƒœ:** `generate_batch`ì—ì„œ ê¸°ì¡´ íŒŒì¼ ìŠ¤í‚µ ë¡œì§ ìˆìŒ (Line 162-170)

### ì ìˆ˜: 95/100 (ìš°ìˆ˜)

---

## ë¦¬ìŠ¤í¬ ìš”ì•½ ë§¤íŠ¸ë¦­ìŠ¤

| ë¦¬ìŠ¤í¬ | íŒŒì¼ | ì‹¬ê°ë„ | ë°œìƒ í™•ë¥  | ì¡°ì¹˜ ìš°ì„ ìˆœìœ„ |
|--------|------|:------:|:---------:|:------------:|
| R1-1 | publish_content | ì¤‘ê°„ | ë†’ìŒ | P1 |
| R1-2 | publish_content | ë‚®ìŒ | ë‚®ìŒ | P3 |
| R1-3 | publish_content | ì¤‘ê°„ | ì¤‘ê°„ | P2 |
| R1-4 | publish_content | ì¤‘ê°„ | ì¤‘ê°„ | P2 |
| R2-1 | auto_scheduler | ì¤‘ê°„ | ë‚®ìŒ | P2 |
| R2-2 | auto_scheduler | ë‚®ìŒ | ë‚®ìŒ | P3 |
| R2-3 | auto_scheduler | ë‚®ìŒ | ë‚®ìŒ | P3 |
| R2-4 | auto_scheduler | ë‚®ìŒ | ë‚®ìŒ | P3 |
| R3-1 | generate_images | - | - | âœ… í•´ê²°ë¨ |
| R3-2 | generate_images | ë‚®ìŒ | ë‚®ìŒ | P3 |
| R3-3 | generate_images | ë‚®ìŒ | ë‚®ìŒ | P3 |

---

## ê¶Œì¥ ì¡°ì¹˜

### P1 (ì¦‰ì‹œ ì¡°ì¹˜ ê¶Œì¥)

| # | ë¦¬ìŠ¤í¬ | ì¡°ì¹˜ ë‚´ìš© |
|:-:|--------|----------|
| 1 | R1-1 | CONTENT_MAPì„ config JSONìœ¼ë¡œ ë¶„ë¦¬ ë˜ëŠ” ìë™ ìŠ¤ìº” ë„ì… |

### P2 (Phase 3ì—ì„œ ì¡°ì¹˜)

| # | ë¦¬ìŠ¤í¬ | ì¡°ì¹˜ ë‚´ìš© |
|:-:|--------|----------|
| 1 | R1-3 | RetryManager MAX_RETRIES ê²€ì¦ ë° ìƒí•œ ê°•ì œ |
| 2 | R1-4 | ê²Œì‹œ ì „ ì¤‘ë³µ ì²´í¬ ë° ë½ ë©”ì»¤ë‹ˆì¦˜ ë„ì… |
| 3 | R2-1 | íŒŒì¼ ë½ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë„ì… |

### P3 (ê´€ì°° ìœ ì§€)

| # | ë¦¬ìŠ¤í¬ | ë¹„ê³  |
|:-:|--------|------|
| 1 | R1-2 | í˜„ì¬ ì•ˆì „ (ëª¨ë‹ˆí„°ë§ ìœ ì§€) |
| 2 | R2-2, R2-3, R2-4 | ì˜í–¥ ë‚®ìŒ |
| 3 | R3-2, R3-3 | ì˜í–¥ ë‚®ìŒ |

---

## ê²€ì¦ëœ ì•ˆì „ í•­ëª©

### ë³´ì•ˆ

```
âœ… API ì‹œí¬ë¦¿ .env ë¶„ë¦¬
âœ… ì‹œí¬ë¦¿ ì½”ë“œ ë‚´ í•˜ë“œì½”ë”© ì—†ìŒ
âœ… ëª¨ë¸ ID ì´ì¤‘ ê²€ì¦ (generate_images.py)
```

### ì•ˆì •ì„±

```
âœ… ê²Œì‹œ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§ (ìµœëŒ€ 3íšŒ)
âœ… í…”ë ˆê·¸ë¨ ì•Œë¦¼ ì‹¤íŒ¨ê°€ ë©”ì¸ ë¡œì§ì— ì˜í–¥ ì—†ìŒ
âœ… ìŠ¤ì¼€ì¤„ ë°ì´í„° JSON ë°±ì—… ê°€ëŠ¥
```

### ë°ì´í„° ë¬´ê²°ì„±

```
âœ… ê²Œì‹œ ì™„ë£Œ ì‹œ ë™ê¸°í™” (on_publish_complete)
âœ… ìŠ¤ì¼€ì¤„ ìƒíƒœ ì¶”ì  (pending/completed/failed)
âœ… ì´ë¯¸ì§€ ìƒì„± ì‹œ ê¸°ì¡´ íŒŒì¼ ìŠ¤í‚µ ì˜µì…˜
```

---

## ê²°ë¡ 

### ì „ì²´ ì ìˆ˜: 85/100 (ì–‘í˜¸)

| íŒŒì¼ | ì ìˆ˜ | íŒì • |
|------|:----:|:----:|
| publish_content.py | 75ì  | ê°œì„  í•„ìš” |
| auto_scheduler.py | 85ì  | ì–‘í˜¸ |
| generate_images.py | 95ì  | ìš°ìˆ˜ |

### Day 11 ì‹œì  íŒë‹¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                         â”‚
â”‚  ì¹˜ëª…ì  ë¦¬ìŠ¤í¬: 0ê±´                                      â”‚
â”‚  ë†’ì€ ë¦¬ìŠ¤í¬: 1ê±´ (R1-1 CONTENT_MAP ìˆ˜ë™ ê´€ë¦¬)           â”‚
â”‚  ì¤‘ê°„ ë¦¬ìŠ¤í¬: 4ê±´ (P2 ì¡°ì¹˜ ê¶Œì¥)                         â”‚
â”‚  ë‚®ì€ ë¦¬ìŠ¤í¬: 6ê±´ (ê´€ì°° ìœ ì§€)                            â”‚
â”‚                                                         â”‚
â”‚  ê²°ë¡ : Phase 2.5 ì§„ì…ì— ë¬¸ì œ ì—†ìŒ                        â”‚
â”‚        P1 ì¡°ì¹˜ëŠ” Phase 3ì—ì„œ ì§„í–‰ ê°€ëŠ¥                   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ì¶”ê°€ ì ê²€ í•„ìš” í•­ëª© (Phase 2.5)

```
â–¡ retry_manager.py - MAX_RETRIES ìƒìˆ˜ í™•ì¸
â–¡ sync_manager.py - ë™ê¸°í™” ë¡œì§ ê²€ì¦
â–¡ publisher.py (core/agents) - Instagram API í˜¸ì¶œ ë¡œì§
â–¡ threads_post.py - Threads API ì˜¤ë¥˜ ì²˜ë¦¬
```

---

âš ï¸ DRAFT - í™•ì • ì•„ë‹˜
**ì‘ì„±ì:** ê¹€ë¶€ì¥ (Claude Opus 4.5)
**ê²€í†  ëŒ€ê¸°:** PDë‹˜
