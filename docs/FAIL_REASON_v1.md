# FAIL-REASON 사전 v1 (Draft)

> **상태:** DRAFT - 확정 아님
> **작성일:** 2026-01-31 (Day 11 야간)
> **데이터 범위:** Day 1~11 실제 사례
> **총 FAIL 수:** 8건

---

## 요약 통계

| 코드 | 유형 | 건수 | 비중 |
|:----:|------|:----:|:----:|
| F1 | 판단 불가 | 1건 | 11.1% |
| F2 | 기준 충돌 | 2건 | 22.2% |
| F3 | 데이터 부족 | 3건 | 33.3% |
| F4 | 규칙 위반 | 2건 | 22.2% |
| F5 | 반복 실패 | 0건 | 0% |
| F6 | HARD FAIL | 0건 | 0% |
| F8 | CTA AI 금지 | 1건 | 11.1% |
| **합계** | | **9건** | **100%** |

---

## F1: 판단 불가

### 정의
정보가 부족하여 결정을 내릴 수 없는 상태. 에이전트가 판단에 필요한 데이터를 신뢰할 수 있는 출처에서 확인할 수 없음.

### 실제 예시

#### 예시 1: fake_food (Day 9)
```
콘텐츠: fake_food (존재하지 않는 음식)
상황: 의도적 파괴 테스트 - 실존하지 않는 음식 투입
원인: 음식 정보 자체가 없음, 안전 분류 불가
판정: F1 FAIL → STOP + 정상 회복
결과: 시스템이 정확히 F1 감지 후 중단 (PASS)
```

#### 예시 2: 불명확한 음식 분류 (일반 케이스)
```
상황: topics_expanded.json에 등록되지 않은 음식
원인: 안전 분류 데이터 미확보
판정: F1 → 웹 검색 재시도 또는 HUMAN_QUEUE
```

#### 예시 3: 신뢰할 수 없는 출처 (가정)
```
상황: 음식 안전성에 대한 상충되는 정보
원인: 신뢰 가능한 단일 출처 부재
판정: F1 → 수의사/전문가 출처 우선 검색
```

### 판정 기준
```
다음 중 하나 이상 해당 시 F1 선언:
□ 음식이 topics_expanded.json에 없고 웹 검색으로도 확인 불가
□ 안전 분류(SAFE/CAUTION/DANGER/FORBIDDEN) 판정 불가
□ 급여량 기준 데이터 전무
□ 상충되는 정보만 존재하여 판단 불가
```

### 재시도 전략
1. 추가 웹 검색 (수의사/전문가 출처 우선)
2. topics_expanded.json 유사 음식 참조
3. 2회 재시도 후에도 불가 → HUMAN_QUEUE

---

## F2: 기준 충돌

### 정의
두 개 이상의 규칙이 서로 모순되는 상태. 어느 규칙을 따라야 할지 명확하지 않음. **⚠️ 특례 적용: 최초 2회는 계속 진행**

### 실제 예시

#### 예시 1: kitkat (Day 5) ✅ 실제 발생
```
콘텐츠: kitkat (킷캣)
상황: DANGER 음식인데 캡션에 "✅ 먹어도 돼요" 사용
원인: 캡션 템플릿 자동 선택 로직 누락
판정: F2+F4 복합 FAIL → STOP
수정: 캡션 "🚫 급여를 권장하지 않습니다"로 변경
결과: Day 7 수정 완료, AOC v0.3 캡션 제약 로직 추가
```

#### 예시 2: paradox_food (Day 10) ✅ 실제 발생
```
콘텐츠: paradox_food (의도적 파괴 테스트)
상황: 모순된 안전 정보를 가진 가상 음식
원인: SAFE이면서 동시에 DANGER 표시
판정: F2 FAIL (F1 도망 없음 확인) → STOP + 복구
결과: 시스템이 F2로 정확히 분류 (PASS)
```

#### 예시 3: tuna/kale CAUTION + SAFE 톤 (Day 12) ✅ 실제 발생
```
콘텐츠: tuna (참치), kale (케일)
상황: CAUTION 분류인데 "먹어도 돼요! ✅" 사용
원인: 캡션 템플릿이 SAFE 톤 고정
판정: F2 FAIL → HARD FAIL #2 트리거
수정: "주의하며 급여하세요! ⚠️" 톤으로 변경
결과: Day 12 수정 완료
```

#### 예시 4: 슬라이드 수 규칙 충돌 (가정)
```
상황: CLAUDE.md "4장 슬라이드" vs 기존 콘텐츠 "7장 슬라이드"
원인: 버전 간 규칙 불일치
판정: F2 → 최신 규칙(CLAUDE.md) 우선 적용
```

### 판정 기준
```
다음 중 하나 이상 해당 시 F2 선언:
□ 안전 분류와 캡션 톤 불일치 (DANGER + "먹어도 돼요")
□ 두 문서의 규칙이 상충 (CLAUDE.md vs 기존 규칙)
□ 이미지 메시지와 캡션 메시지 모순
□ 버전 간 포맷/규칙 불일치
```

### 재시도 전략
1. AOC v0.3 캡션 제약 로직 적용
2. 최신 문서 규칙 우선
3. 캡션-안전분류 정합성 재검사
4. 3회 누적 시에만 자동 중단

---

## F3: 데이터 부족

### 정의
입력 데이터가 확보되지 않음. 필수 파일/정보 누락. **⚠️ 가장 빈번한 FAIL 유형 (37.5%)**

### 실제 예시

#### 예시 1: onion (Day 5) ✅ 실제 발생
```
콘텐츠: onion (양파)
상황: 본문 슬라이드(01~03) 이미지 없음
원인: 이미지 생성 단계 미완료
판정: F3 FAIL → STOP
수정: 이미지 생성 필요 (미완성 콘텐츠로 보류)
상태: Day 8 F3 차단 검증에서 정확히 STOP 확인
```

#### 예시 2: garlic (Day 5) ✅ 실제 발생
```
콘텐츠: garlic (마늘)
상황: 본문 슬라이드(01~03) 이미지 없음
원인: 이미지 생성 단계 미완료
판정: F3 FAIL → STOP
수정: 이미지 생성 필요 (미완성 콘텐츠로 보류)
상태: Day 8 F3 차단 검증에서 정확히 STOP 확인
```

#### 예시 3: incomplete_food (Day 10) ✅ 실제 발생
```
콘텐츠: incomplete_food (의도적 미완성)
상황: 의도적으로 데이터 누락시킨 테스트
원인: 병렬 FAIL 포함 테스트
판정: F3 FAIL → STOP (다른 Task와 충돌 없음)
결과: 시스템이 정확히 F3 감지 (PASS)
```

### 판정 기준
```
다음 중 하나 이상 해당 시 F3 선언:
□ 텍스트 설정 파일 없음 ({topic}_text.json)
□ 본문 이미지 파일 누락 (01~03.png)
□ 캡션 파일 없음 (caption_instagram.txt)
□ 표지 이미지 없음 (00.png)
□ 배경 이미지 파일 없음 (*_bg.png)
```

### 재시도 전략
1. 누락 파일 목록 명시
2. 자동 생성 가능 시 생성 시도
3. 자동 생성 불가 시 즉시 STOP

---

## F4: 규칙 위반

### 정의
기존 규칙에 명시적으로 위배됨. 검증 가능한 규칙 불충족.

### 실제 예시

#### 예시 1: icecream (Day 4) ✅ 실제 발생
```
콘텐츠: icecream (아이스크림)
상황: 캡션/이미지 메시지 불일치
원인: DANGER 음식인데 이미지 톤이 긍정적
판정: F4 FAIL → STOP
수정: 캡션 "급여를 권장하지 않습니다"로 변경
결과: 수정 후 94점으로 PASS
```

#### 예시 2: salmon 다른 개 등장 (Day 3) ✅ 실제 발생
```
콘텐츠: salmon (연어)
상황: 03번 슬라이드에 햇살이 외 다른 개 등장
원인: AI 이미지 생성 결과물 검수 누락
판정: RF1 (Red Flag 1) - 브랜드 일관성 위배
수정: 이미지 교체 후 RF1-TAGGED로 게시 가능
결과: 규칙 위반이나 경미하여 태그 후 진행
```

#### 예시 3: AI 표기 누락 (가정)
```
상황: 캡션에 AI 생성 표기 문구 없음
원인: 캡션 템플릿에 문구 미포함
판정: F4 FAIL → 자동 수정 가능
수정: "ℹ️ 일부 이미지는 AI로 생성되었습니다." 추가
```

### 판정 기준
```
다음 중 하나 이상 해당 시 F4 선언:
□ AI 표기 누락 (필수 문구 미포함)
□ 금지 포즈 사용 (먹기/핥기/만지기)
□ 이미지 규격 불일치 (1080x1080 아님)
□ 해시태그 개수 초과 (8~12개 범위 이탈)
□ 캡션 글자수 초과 (2200자 초과)
□ 브랜드 일관성 위배 (다른 개 등장 등)
```

### 재시도 전략
1. 위반 규칙 명시
2. 자동 수정 가능 시 즉시 수정
3. 자동 수정 후 재검증

---

## F5: 반복 실패

### 정의
동일한 시도가 2회 이상 실패. 같은 원인으로 반복적으로 FAIL.

### 실제 예시

#### 예시 1: 발생 기록 없음
```
Day 1~11 기간 중 F5 발생 사례 없음
시스템이 재시도 전략을 통해 F5 전에 복구 성공
```

#### 예시 2: 이미지 생성 연속 실패 (가정)
```
상황: 동일 프롬프트로 2회 연속 부적절한 이미지 생성
원인: 프롬프트 자체의 문제
판정: F5 FAIL → 즉시 중단
조치: PD 알림 필수, 프롬프트 수정 필요
```

#### 예시 3: API 연속 실패 (가정)
```
상황: Instagram API 2회 연속 실패
원인: 토큰 만료 또는 rate limit
판정: F5 FAIL → 즉시 중단
조치: API 상태 확인 후 재시도
```

### 판정 기준
```
다음 해당 시 F5 선언:
□ 동일한 FAIL 사유로 2회 이상 실패
□ 동일한 재시도 전략 적용 후에도 실패
□ 같은 파일/API에서 연속 오류
```

### 재시도 전략
1. 즉시 자동 중단 (재시도 금지)
2. PD 알림 필수
3. 원인 분석 후 수동 개입

---

## F6: HARD FAIL (Day 12 추가)

### 정의
시스템 무결성을 위협하는 치명적 실패. **재시도 없이 즉시 중단 필수.** 자동 수정 시도 금지.

### 트리거 조건

#### HARD FAIL #1: CONTENT_MAP 검증 실패
```
상황: 게시 대상 topic이 CONTENT_MAP에 없거나 blocked 상태
원인: 콘텐츠 등록 누락 또는 의도적 차단
판정: F6 HARD FAIL → 즉시 중단
조치: 콘텐츠 등록 또는 차단 해제 필요
```

#### HARD FAIL #2: 캡션-안전분류 불일치
```
상황: 안전 분류와 캡션 톤이 일치하지 않음
예시: CAUTION 음식 + "급여 가능합니다!" 캡션
원인: 캡션 생성 로직 오류 또는 수동 편집 실수
판정: F6 HARD FAIL → 즉시 중단
조치: 캡션 수정 후 재검증 필요
```

#### HARD FAIL #3: Safety 24h FAIL
```
상황: 최근 24시간 내 계정 제한/신고/경고 발생
원인: Instagram 정책 위반 또는 사용자 신고
판정: F6 HARD FAIL → 48시간 전체 중단
조치: PD님 승인 후에만 재개 가능
```

### 판정 기준
```
다음 중 하나 이상 해당 시 F6 선언:
□ CONTENT_MAP 검증 실패 (topic 없음, 경로 무효, blocked)
□ 캡션-안전분류 불일치 (CAUTION + SAFE 톤 등)
□ 계정 Safety 24h FAIL (제한/신고/경고)
```

### 재시도 전략
```
⛔ 재시도 금지 - HARD FAIL은 즉시 중단 원칙

1. 즉시 게시 중단
2. 로그에 F6 기록
3. 텔레그램 알림 발송
4. PD님 승인 대기
5. 원인 해결 후 수동 재시작
```

---

## F8: CTA 슬라이드 AI 생성 금지 위반 (Day 12 추가)

### 정의
CTA 슬라이드(03번)에 AI 생성 이미지를 사용한 경우. **실사진 필수 규칙 위반.**

### 트리거 조건
```
조건: slide_index == 03 AND image_source == AI
판정: HARD FAIL
조치: 게시 차단, 실사진 교체
```

### 슬라이드별 생성 규칙

| 슬라이드 | 역할 | 생성 방식 |
|----------|------|----------|
| 00 | 표지 | AI 허용 |
| 01 | 본문 | AI 허용 |
| 02 | 본문 | AI 허용 |
| 03 | CTA | **실사진 필수** |

### 실제 예시

#### 예시 1: shrimp_03 AI 생성 (Day 12)
```
콘텐츠: shrimp (새우)
상황: CTA 슬라이드에 fal-ai/flux-2-pro 생성 이미지 사용
원인: 규칙 미숙지 - 03번은 실사진 필수
판정: F8 HARD FAIL → 즉시 차단
조치: best_cta 폴더에서 실사진으로 교체
결과: grade_b_haetsali_happy_030.jpg로 교체 완료
```

### 판정 기준
```
□ 슬라이드 03번(CTA)에 AI 이미지 사용
□ 실사진 템플릿 미사용

※ 위 조건 중 하나라도 해당 시 F8 선언
※ 자동 감지: 파일 메타데이터 또는 경로에서 AI 마킹 확인
```

### 재시도 전략
```
1. AI 생성 이미지 archive로 이동 (삭제 금지)
2. best_cta/ 폴더에서 실사진 선택
3. 1080x1080 규격 확인 후 복사
4. 텍스트 오버레이 적용 (필요시)
5. 재검수 진행
```

### 실사진 소스 경로
```
content/images/sunshine/cta_source/best_cta/
├── grade_b_haetsali_happy_*.jpg  (실내/클로즈업)
├── haetsali_happy_sit_indoor_*.jpg  (앉은 포즈)
├── haetsali_with_human_*.jpg  (보호자와 함께)
└── grade_b_haetsali_outdoor_*.jpg  (야외)
```

---

## F-INFO-EMPTY: INFO 슬라이드 텍스트 누락 (Day 12 추가)

### 정의
정보 슬라이드(01, 02번)에 텍스트가 없는 경우. **구조적 위험 - 텍스트 오버레이 필수.**

### 트리거 조건
```
조건: slide_index IN [01, 02] AND text == EMPTY
판정: SOFT FAIL
조치: 텍스트 오버레이 추가 (재생성 금지)
```

### 실제 예시

#### 예시 1: shrimp_02 텍스트 누락 (Day 12)
```
콘텐츠: shrimp (새우)
상황: 본문 슬라이드(02)에 텍스트 없이 이미지만 존재
원인: AI 생성 시 텍스트 미포함 (오타 수정 재생성)
판정: F-INFO-EMPTY → 텍스트 오버레이 필요
조치: "새우는 반드시 익혀서 급여하세요" 오버레이 추가
결과: 완료 - 기준 샘플로 지정
```

### CAUTION 콘텐츠 텍스트 템플릿
```
조리 필수: "{음식}은(는) 반드시 익혀서 급여하세요"
양 조절:   "{음식}은(는) 소량만 급여하세요"
가공 필수: "{음식}은(는) 반드시 껍질/씨를 제거하세요"
```

### 재시도 전략
```
⚠️ 재생성 금지 - 오버레이만 허용

1. 원본 이미지 archive/ 백업
2. 안전도에 맞는 텍스트 선택
3. 오버레이 스크립트 실행
4. 위치: 이미지 하단
5. 스타일: 흰색 텍스트 + 반투명 배경
```

### F5와 F6 차이점

| 구분 | F5 (반복 실패) | F6 (HARD FAIL) |
|------|---------------|----------------|
| 트리거 | 2회 이상 동일 실패 | 1회 치명적 실패 |
| 재시도 | 금지 (3회 누적 후) | 즉시 금지 |
| 자동 수정 | 불가 | 절대 불가 |
| 범위 | 해당 Task만 | 해당 Task (Safety는 전체) |
| 재개 조건 | 수동 개입 | PD 승인 필수 |

---

## FAIL-REASON 재사용 패턴

### Day 1~11 재사용 통계

| 패턴 | 재사용 횟수 | 재사용률 |
|------|:----------:|:--------:|
| F3 데이터 부족 → 파일 확인 | 3회 | 100% |
| F2 캡션 불일치 → AOC v0.3 | 2회 | 100% |
| F4 규칙 위반 → 자동 수정 | 2회 | 100% |
| **전체** | **8회 중 8회** | **100%** |

### 재사용 가능한 FAIL-REASON 코드

```
FR-001: F3 - 이미지 파일 누락 (01~03.png)
FR-002: F3 - 텍스트 설정 파일 누락 ({topic}_text.json)
FR-003: F2 - 캡션-안전분류 불일치
FR-004: F4 - AI 표기 누락
FR-005: F4 - 브랜드 일관성 위배 (다른 개 등장)
FR-006: F1 - 음식 정보 미확인
```

---

## 패턴 분석

### Top 3 FAIL 원인

| 순위 | 유형 | 비중 | 근본 원인 |
|:----:|------|:----:|----------|
| 1 | F3 (데이터 부족) | 37.5% | 콘텐츠 제작 미완료 |
| 2 | F2 (기준 충돌) | 25% | 캡션-안전분류 로직 부재 |
| 3 | F4 (규칙 위반) | 25% | 검수 누락 |

### 개선 완료 항목

- [x] F2 방지: AOC v0.3 캡션 제약 로직 추가 (Day 7)
- [x] F3 감지: 차단 정확도 100% 검증 (Day 8)
- [x] F1 비중: 20% 이하 유지 (Day 10: 12.5%)

### 추가 필요 항목

- [ ] F3 사전 방지: 콘텐츠 제작 완료 체크리스트
- [ ] F4 자동 수정: 규칙 위반 자동 복구 강화
- [ ] F5 예방: 재시도 로직 개선

---

⚠️ DRAFT - 확정 아님
**작성자:** 김부장 (Claude Opus 4.5)
**검토 대기:** PD님
